<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContentFlow - Gestão de Conteúdo</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: 'var(--primary-color)',
                        'primary-dark': 'var(--primary-dark)',
                        'primary-light': 'var(--primary-light)',
                    }
                }
            }
        }
    </script>
    
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --bg-color: #f9fafb;
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --text-muted: #6b7280;
            --border-color: #e5e7eb;
        }
        
        [data-theme="dark"] {
            --bg-color: #111827;
            --card-bg: #1f2937;
            --text-color: #f9fafb;
            --text-muted: #9ca3af;
            --border-color: #374151;
        }
        
        * { font-family: 'Inter', sans-serif; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        
        .card {
            background-color: var(--card-bg);
            border-color: var(--border-color);
        }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        [data-theme="dark"] ::-webkit-scrollbar-thumb { background: #4b5563; }
        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        #sidebar ::-webkit-scrollbar { width: 4px; }
        #sidebar ::-webkit-scrollbar-track { background: transparent; }
        #sidebar ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 2px; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-in { animation: slideIn 0.3s ease-out; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .sync-pulse { animation: pulse 2s infinite; }
        
        .glass { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px); 
        }
        
        [data-theme="dark"] .glass {
            background: rgba(31, 41, 55, 0.95);
        }
        
        .status-ideia { background-color: #f3f4f6; color: #6b7280; }
        [data-theme="dark"] .status-ideia { background-color: #374151; color: #9ca3af; }
        
        .status-roteiro { background-color: #dbeafe; color: #1e40af; }
        [data-theme="dark"] .status-roteiro { background-color: #1e3a8a; color: #93c5fd; }
        
        .status-gravando { background-color: #fef3c7; color: #92400e; }
        [data-theme="dark"] .status-gravando { background-color: #78350f; color: #fcd34d; }
        
        .status-editando { background-color: #fce7f3; color: #9d174d; }
        [data-theme="dark"] .status-editando { background-color: #831843; color: #f9a8d4; }
        
        .status-agendado { background-color: #d1fae5; color: #065f46; }
        [data-theme="dark"] .status-agendado { background-color: #064e3b; color: #6ee7b7; }
        
        .status-publicado { background-color: #c7d2fe; color: #3730a3; }
        [data-theme="dark"] .status-publicado { background-color: #312e81; color: #a5b4fc; }

        .priority-Alta { border-left: 4px solid #ef4444; }
        .priority-Média { border-left: 4px solid #f59e0b; }
        .priority-Baixa { border-left: 4px solid #10b981; }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: var(--border-color); }
        .calendar-day { background-color: var(--card-bg); min-height: 120px; }
        
        [data-theme="dark"] input,
        [data-theme="dark"] select,
        [data-theme="dark"] textarea {
            background-color: #374151 !important;
            border-color: #4b5563 !important;
            color: #f9fafb !important;
        }
        
        [data-theme="dark"] input::placeholder,
        [data-theme="dark"] textarea::placeholder {
            color: #9ca3af !important;
        }
        
        .kanban-column { min-height: 500px; transition: all 0.3s; }
        
        .dragging { opacity: 0.5; transform: scale(0.95); }
        .drag-over { background-color: #f0f9ff; border: 2px dashed var(--primary-color); }
        [data-theme="dark"] .drag-over { background-color: #1e3a8a; }
        
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }
        
        .rich-textarea { min-height: 200px; resize: vertical; }

        .auth-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        [data-theme="dark"] .auth-card {
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.4);
        }

        .hidden { display: none !important; }
        
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.9);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        [data-theme="dark"] .loading-overlay {
            background: rgba(17, 24, 39, 0.9);
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #e5e7eb;
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        [data-theme="dark"] .toggle-switch {
            background: #374151;
        }
        
        .toggle-switch.active {
            background: var(--primary-color);
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }
        
        .toggle-switch.active::after {
            transform: translateX(24px);
        }

        /* ESTILOS NOVOS PARA UPLOAD E LISTAS EDITÁVEIS */
        .upload-zone {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        [data-theme="dark"] .upload-zone {
            border-color: #4b5563;
        }
        
        .upload-zone:hover, .upload-zone.dragover {
            border-color: #6366f1;
            background-color: rgba(99, 102, 241, 0.05);
        }
        
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        
        [data-theme="dark"] .file-item {
            background: #374151;
            border-color: #4b5563;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        [data-theme="dark"] .progress-bar {
            background: #4b5563;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            transition: width 0.3s;
        }

        .editable-list-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        
        [data-theme="dark"] .editable-list-item {
            background: #374151;
            border-color: #4b5563;
        }
        
        .editable-list-item input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0.25rem;
        }
        
        [data-theme="dark"] .editable-list-item input {
            color: #f9fafb;
        }
    </style>
</head>
<body class="h-screen overflow-hidden">

    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay hidden">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-600 font-medium dark:text-gray-300">Sincronizando...</p>
        </div>
    </div>

    <!-- Sync Status Indicator -->
    <div id="sync-status" class="fixed top-4 right-4 z-50 hidden">
        <div class="flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-medium shadow-lg">
            <i class="fas fa-check-circle"></i>
            <span>Sincronizado</span>
        </div>
    </div>

    <!-- AUTHENTICATION PAGES -->
    <div id="auth-container" class="auth-bg flex items-center justify-center p-4">
        <!-- Login Page -->
        <div id="login-page" class="auth-card w-full max-w-md rounded-2xl shadow-2xl p-8 animate-slide-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-white font-bold text-2xl mx-auto mb-4 shadow-lg">CF</div>
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">ContentFlow</h1>
                <p class="text-gray-500 mt-2 dark:text-gray-400">Gestão de Conteúdo Digital</p>
            </div>

            <form onsubmit="handleLogin(event)" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                    <div class="relative">
                        <i class="fas fa-envelope absolute left-3 top-3 text-gray-400"></i>
                        <input type="email" id="login-email" required class="w-full pl-10 pr-4 py-3 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="seu@email.com">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Senha</label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                        <input type="password" id="login-password" required class="w-full pl-10 pr-4 py-3 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="••••••••">
                    </div>
                </div>

                <button type="submit" class="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all">
                    <span>Entrar</span>
                    <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </form>

            <div class="mt-6 text-center">
                <p class="text-gray-600 dark:text-gray-400">
                    Não tem uma conta? 
                    <button onclick="showRegister()" class="text-indigo-600 hover:text-indigo-800 font-semibold ml-1">Criar conta</button>
                </p>
            </div>
        </div>

        <!-- Register Page -->
        <div id="register-page" class="auth-card w-full max-w-md rounded-2xl shadow-2xl p-8 hidden animate-slide-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-white font-bold text-2xl mx-auto mb-4 shadow-lg">CF</div>
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Criar Conta</h1>
            </div>

            <form onsubmit="handleRegister(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome Completo</label>
                    <div class="relative">
                        <i class="fas fa-user absolute left-3 top-3 text-gray-400"></i>
                        <input type="text" id="register-name" required class="w-full pl-10 pr-4 py-3 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Seu nome">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                    <div class="relative">
                        <i class="fas fa-envelope absolute left-3 top-3 text-gray-400"></i>
                        <input type="email" id="register-email" required class="w-full pl-10 pr-4 py-3 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="seu@email.com">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Senha</label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                        <input type="password" id="register-password" required minlength="6" class="w-full pl-10 pr-4 py-3 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Mínimo 6 caracteres">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Confirmar Senha</label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                        <input type="password" id="register-password-confirm" required class="w-full pl-10 pr-4 py-3 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Repita a senha">
                    </div>
                </div>

                <button type="submit" class="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all">
                    <span>Criar Conta</span>
                    <i class="fas fa-user-plus ml-2"></i>
                </button>
            </form>

            <div class="mt-6 text-center">
                <p class="text-gray-600 dark:text-gray-400">
                    Já tem uma conta? 
                    <button onclick="showLogin()" class="text-indigo-600 hover:text-indigo-800 font-semibold ml-1">Entrar</button>
                </p>
            </div>
        </div>
    </div>

    <!-- MAIN APPLICATION -->
    <div id="app-container" class="hidden h-screen">
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 z-40 transition-transform duration-300 transform translate-x-0 flex flex-col">
            <div class="p-6 border-b border-gray-100 dark:border-gray-700 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center text-white font-bold text-xl">CF</div>
                    <div>
                        <h1 class="font-bold text-xl text-gray-900 dark:text-white">ContentFlow</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400" id="user-display-name">Usuário</p>
                    </div>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto py-4 px-4 space-y-1">
                <button onclick="navigateTo('dashboard')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-indigo-600 transition-colors" data-page="dashboard">
                    <i class="fas fa-chart-pie w-5"></i>
                    <span class="font-medium">Dashboard</span>
                </button>
                <button onclick="navigateTo('calendario')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-indigo-600 transition-colors" data-page="calendario">
                    <i class="fas fa-calendar-week w-5"></i>
                    <span class="font-medium">Calendário</span>
                </button>
                <button onclick="navigateTo('pipeline')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-indigo-600 transition-colors" data-page="pipeline">
                    <i class="fas fa-columns w-5"></i>
                    <span class="font-medium">Pipeline</span>
                </button>
                <button onclick="navigateTo('banco')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-indigo-600 transition-colors" data-page="banco">
                    <i class="fas fa-database w-5"></i>
                    <span class="font-medium">Banco de Conteúdos</span>
                </button>
                <button onclick="navigateTo('banco-dados')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-indigo-600 transition-colors" data-page="banco-dados">
                    <i class="fas fa-server w-5"></i>
                    <span class="font-medium">Banco de Dados</span>
                </button>
                <button onclick="navigateTo('metricas')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-indigo-600 transition-colors" data-page="metricas">
                    <i class="fas fa-chart-line w-5"></i>
                    <span class="font-medium">Métricas</span>
                </button>
                <button onclick="navigateTo('insights')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-indigo-600 transition-colors" data-page="insights">
                    <i class="fas fa-bolt w-5"></i>
                    <span class="font-medium">Insights (Redes Sociais)</span>
                </button>
                <button onclick="navigateTo('marca')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-indigo-600 transition-colors" data-page="marca">
                    <i class="fas fa-crown w-5"></i>
                    <span class="font-medium">Marca</span>
                </button>
                <!-- NOVA ABA CONFIGURAÇÕES -->
                <button onclick="navigateTo('configuracoes')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-indigo-600 transition-colors" data-page="configuracoes">
                    <i class="fas fa-cog w-5"></i>
                    <span class="font-medium">Configurações</span>
                </button>
                
                <div class="pt-4 mt-4 border-t border-gray-200 dark:border-gray-700">
                    <button onclick="generateStrategicReport()" class="w-full flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg">
                        <i class="fas fa-file-alt w-5"></i>
                        <span class="font-medium text-sm">Gerar Relatório Estratégico</span>
                    </button>
                </div>
            </div>

            <div class="p-4 border-t border-gray-200 dark:border-gray-700 space-y-2 flex-shrink-0 bg-white dark:bg-gray-800">
                <div class="flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                    <div class="w-8 h-8 rounded-full bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center text-indigo-600 dark:text-indigo-400 font-semibold text-sm" id="user-avatar">U</div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900 dark:text-white truncate" id="sidebar-user-name">Usuário</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400 truncate" id="sidebar-user-email">email@exemplo.com</p>
                    </div>
                </div>
                
                <div id="sidebar-sync-status" class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-green-500 sync-pulse"></div>
                    <span>Online - Sincronizado</span>
                </div>
                
                <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors">
                    <i class="fas fa-sign-out-alt w-5"></i>
                    <span class="font-medium">Sair</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="ml-64 h-full overflow-y-auto bg-gray-50 dark:bg-gray-900">
            <header class="sticky top-0 z-30 glass border-b border-gray-200 dark:border-gray-700 px-8 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <button onclick="toggleSidebar()" class="lg:hidden text-gray-600 dark:text-gray-300 hover:text-gray-900">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h2 id="page-title" class="text-2xl font-bold text-gray-900 dark:text-white">Dashboard</h2>
                    </div>
                    
                    <div class="flex items-center gap-4">
                        <div class="relative hidden md:block">
                            <input type="text" id="global-search" placeholder="Buscar conteúdos..." class="w-64 pl-10 pr-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" onkeyup="handleSearch(event)">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        
                        <button onclick="openModal()" class="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-lg">
                            <i class="fas fa-plus"></i>
                            <span class="hidden sm:inline">Novo Conteúdo</span>
                        </button>
                    </div>
                </div>
            </header>

            <div id="content-container" class="p-8"></div>
        </main>
    </div>

    <!-- Content Modal -->
    <div id="content-modal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto pointer-events-auto animate-slide-in border border-gray-200 dark:border-gray-700">
                <div class="sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-100 dark:border-gray-700 px-6 py-4 flex items-center justify-between z-10">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white" id="modal-title">Novo Conteúdo</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="content-form" class="p-6 space-y-6" onsubmit="saveContent(event)">
                    <input type="hidden" id="content-id">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Título</label>
                            <input type="text" id="titulo" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Mês/Ano</label>
                            <input type="month" id="mes" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data Prevista</label>
                            <input type="date" id="data-prevista" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Canal</label>
                            <select id="canal" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500"></select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo</label>
                            <select id="tipo" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500"></select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Quadro/Tema</label>
                            <select id="quadro" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500"></select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Funil</label>
                            <select id="funil" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <option value="Topo">Topo</option>
                                <option value="Meio">Meio</option>
                                <option value="Fundo">Fundo</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Objetivo</label>
                            <select id="objetivo" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500"></select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Responsável</label>
                            <input type="text" id="responsavel" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="Nome do responsável">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status</label>
                            <select id="status" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500" onchange="updateStatusDateVisibility()">
                                <option value="Ideia">Ideia</option>
                                <option value="Roteiro">Roteiro</option>
                                <option value="Gravando">Gravando</option>
                                <option value="Editando">Editando</option>
                                <option value="Agendado">Agendado</option>
                                <option value="Publicado">Publicado</option>
                            </select>
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2">
                                <i class="fas fa-calendar-check text-indigo-500"></i>
                                Datas Previstas por Etapa
                            </label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl">
                                <div class="status-date-field" data-status="Ideia">
                                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Ideia</label>
                                    <input type="date" id="data-status-ideia" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div class="status-date-field" data-status="Roteiro">
                                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Roteiro</label>
                                    <input type="date" id="data-status-roteiro" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div class="status-date-field" data-status="Gravando">
                                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Gravando</label>
                                    <input type="date" id="data-status-gravando" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div class="status-date-field" data-status="Editando">
                                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Editando</label>
                                    <input type="date" id="data-status-editando" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div class="status-date-field" data-status="Agendado">
                                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Agendado</label>
                                    <input type="date" id="data-status-agendado" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div class="status-date-field" data-status="Publicado">
                                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Publicado</label>
                                    <input type="date" id="data-status-publicado" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Prioridade</label>
                            <select id="prioridade" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <option value="Baixa">Baixa</option>
                                <option value="Média">Média</option>
                                <option value="Alta">Alta</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Link Roteiro</label>
                            <input type="url" id="link-roteiro" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="https://...">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Link Edição</label>
                            <input type="url" id="link-edicao" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="https://...">
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Conteúdo Base</label>
                            <textarea id="conteudo-base" rows="4" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 rich-textarea" placeholder="Ideias principais, conceitos abordados, links de referência..."></textarea>
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Roteiro</label>
                            <textarea id="roteiro" rows="6" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 rich-textarea" placeholder="Estrutura do roteiro..."></textarea>
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observações</label>
                            <textarea id="observacoes" rows="3" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500"></textarea>
                        </div>
                    </div>

                    <div class="flex gap-3 pt-4 border-t border-gray-100 dark:border-gray-700">
                        <button type="button" onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">Cancelar</button>
                        <button type="submit" id="save-btn" class="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2">
                            <span id="save-btn-text">Salvar</span>
                            <i class="fas fa-cloud-upload-alt"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ==================== FIREBASE CONFIG ====================
        const firebaseConfig = {
            apiKey: "AIzaSyAV2tQYhyZigwECLfj3xSMS1b7rBPRAnZg",
            authDomain: "gestao-de-conteudo-83103.firebaseapp.com",
            projectId: "gestao-de-conteudo-83103",
            storageBucket: "gestao-de-conteudo-83103.firebasestorage.app",
            messagingSenderId: "874536664374",
            appId: "1:874536664374:web:0051e811d3cfaf99ccc797"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();

        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let conteudos = [];
        let currentPage = 'dashboard';
        let draggedItem = null;
        let currentCalendarDate = new Date();
        let dashboardSelectedMonth = new Date().toISOString().slice(0, 7);
        let unsubscribeSnapshot = null;
        
        // Configurações expandidas com Objetivo
        let userSettings = {
            theme: 'light',
            canais: ['Instagram', 'YouTube', 'TikTok', 'LinkedIn', 'Twitter', 'Blog'],
            tipos: ['Reel', 'Shorts', 'Live', 'Post', 'Carrossel', 'Vídeo', 'Aula', 'Artigo', 'Story'],
            quadros: ['Eventual', 'Série A', 'Série B', 'Série C', 'Tutorial', 'Review', 'Entrevista', 'Behind the Scenes'],
            objetivos: ['Venda', 'Autoridade', 'Conexão', 'Engajamento', 'Educação', 'Evento']
        };

        // Marca Data com arquivos
        let marcaData = {
            fundamentos: { proposito: '', missao: '', visao: '', valores: '', posicionamento: '', promessa: '', diferencial: '' },
            publico: { publicoAlvo: '', persona: '', dores: '', desejos: '', linguagem: '', objecoes: '' },
            estrategia: { planejamentoAnual: '', metaCrescimento: '', estrategiaFunil: '', estrategiaMonetizacao: '', frequenciaCanal: '' },
            identidade: { arquetipo: '', tomVoz: '', palavrasPermitidas: '', palavrasProibidas: '', manualVisual: '', cores: '', tipografia: '' },
            cultura: { playlistSpotify: '', referencias: '', manifesto: '' },
            arquivos: []
        };

        let insightsData = {
            metaToken: '',
            lastUpdate: null,
            visaoMacro: { alcanceTotal: 0, impressoesTotal: 0, engajamentoMedio: 0, crescimentoSeguidores: 0, melhorConteudo: null, piorConteudo: null },
            conteudos: []
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('contentflow-theme') || 'light';
            setTheme(savedTheme);
            checkAuth();
        });

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            userSettings.theme = theme;
            localStorage.setItem('contentflow-theme', theme);
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
            return newTheme;
        }
        
        function checkAuth() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = {
                        id: user.uid,
                        name: user.displayName || user.email.split('@')[0],
                        email: user.email
                    };
                    loadUserData();
                    loadUserSettings();
                    showApp();
                } else {
                    showAuth();
                }
            });
        }

        async function handleLogin(e) {
            e.preventDefault();
            showLoading(true);
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                alert('Erro ao entrar: ' + error.message);
                showLoading(false);
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            showLoading(true);
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-password-confirm').value;
            
            if (password !== confirmPassword) {
                alert('As senhas não coincidem!');
                showLoading(false);
                return;
            }
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: name });
                await db.collection('users').doc(userCredential.user.uid).set({
                    name: name,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                await db.collection('conteudos').doc(userCredential.user.uid).set({
                    items: [],
                    settings: userSettings,
                    marca: marcaData,
                    insights: insightsData
                });
            } catch (error) {
                alert('Erro: ' + error.message);
                showLoading(false);
            }
        }

        async function logout() {
            if (confirm('Deseja sair?')) {
                showLoading(true);
                if (unsubscribeSnapshot) {
                    unsubscribeSnapshot();
                    unsubscribeSnapshot = null;
                }
                await auth.signOut();
                conteudos = [];
                currentUser = null;
                showLoading(false);
                showAuth();
            }
        }

        function loadUserData() {
            if (!currentUser) return;
            showLoading(true);
            unsubscribeSnapshot = db.collection('conteudos').doc(currentUser.id)
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        conteudos = doc.data().items || [];
                        if (doc.data().settings) {
                            userSettings = { ...userSettings, ...doc.data().settings };
                        }
                        if (doc.data().marca) {
                            marcaData = { ...marcaData, ...doc.data().marca };
                            if (!marcaData.arquivos) marcaData.arquivos = [];
                        }
                        if (doc.data().insights) {
                            insightsData = { ...insightsData, ...doc.data().insights };
                        }
                    } else {
                        conteudos = [];
                        saveUserData();
                    }
                    if (currentPage) navigateTo(currentPage);
                    showSyncStatus();
                    showLoading(false);
                }, (error) => {
                    console.error("Erro ao sincronizar:", error);
                    alert("Erro ao carregar dados. Verifique sua conexão.");
                    showLoading(false);
                });
        }
        
        async function loadUserSettings() {
            if (!currentUser) return;
            try {
                const doc = await db.collection('conteudos').doc(currentUser.id).get();
                if (doc.exists && doc.data().settings) {
                    userSettings = { ...userSettings, ...doc.data().settings };
                    if (userSettings.theme) setTheme(userSettings.theme);
                }
            } catch (error) {
                console.error("Erro ao carregar configurações:", error);
            }
        }
        
        async function saveUserSettings() {
            if (!currentUser) return;
            try {
                await db.collection('conteudos').doc(currentUser.id).update({
                    settings: userSettings,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error("Erro ao salvar configurações:", error);
            }
        }

        async function saveUserData() {
            if (!currentUser) return;
            showSyncStatus('syncing');
            try {
                await db.collection('conteudos').doc(currentUser.id).set({
                    items: conteudos,
                    settings: userSettings,
                    marca: marcaData,
                    insights: insightsData,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                showSyncStatus('saved');
            } catch (error) {
                console.error("Erro ao salvar:", error);
                showSyncStatus('error');
            }
        }

        function showAuth() {
            document.getElementById('auth-container').classList.remove('hidden');
            document.getElementById('app-container').classList.add('hidden');
            document.getElementById('sync-status').classList.add('hidden');
            showLogin();
        }

        function showApp() {
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            document.getElementById('sync-status').classList.remove('hidden');
            document.getElementById('user-display-name').textContent = currentUser.name;
            document.getElementById('sidebar-user-name').textContent = currentUser.name;
            document.getElementById('sidebar-user-email').textContent = currentUser.email;
            document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();
        }

        function showLogin() {
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('register-page').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('register-page').classList.remove('hidden');
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }

        function showSyncStatus(status = 'saved') {
            const indicator = document.getElementById('sync-status');
            const sidebarIndicator = document.getElementById('sidebar-sync-status');
            if (status === 'syncing') {
                indicator.innerHTML = '<div class="flex items-center gap-2 px-4 py-2 bg-yellow-100 text-yellow-700 rounded-full text-sm font-medium shadow-lg"><i class="fas fa-sync fa-spin"></i><span>Sincronizando...</span></div>';
                sidebarIndicator.innerHTML = '<div class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></div><span>Sincronizando...</span>';
            } else if (status === 'saved') {
                indicator.innerHTML = '<div class="flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-medium shadow-lg"><i class="fas fa-check-circle"></i><span>Sincronizado</span></div>';
                sidebarIndicator.innerHTML = '<div class="w-2 h-2 rounded-full bg-green-500"></div><span>Online - Sincronizado</span>';
                setTimeout(() => indicator.classList.add('hidden'), 3000);
            } else if (status === 'error') {
                indicator.innerHTML = '<div class="flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-full text-sm font-medium shadow-lg"><i class="fas fa-exclamation-circle"></i><span>Erro ao sincronizar</span></div>';
                sidebarIndicator.innerHTML = '<div class="w-2 h-2 rounded-full bg-red-500"></div><span>Erro de conexão</span>';
            }
            indicator.classList.remove('hidden');
        }

        // ==================== CONTENT MANAGEMENT ====================
        async function saveContent(e) {
            e.preventDefault();
            showLoading(true);
            
            const idInput = document.getElementById('content-id').value;
            const data = {
                titulo: document.getElementById('titulo').value,
                mes: document.getElementById('mes').value,
                dataPrevista: document.getElementById('data-prevista').value,
                canal: document.getElementById('canal').value,
                tipo: document.getElementById('tipo').value,
                quadro: document.getElementById('quadro').value,
                funil: document.getElementById('funil').value,
                objetivo: document.getElementById('objetivo').value,
                responsavel: document.getElementById('responsavel').value,
                status: document.getElementById('status').value,
                prioridade: document.getElementById('prioridade').value,
                linkRoteiro: document.getElementById('link-roteiro').value,
                linkEdicao: document.getElementById('link-edicao').value,
                conteudoBase: document.getElementById('conteudo-base').value,
                roteiro: document.getElementById('roteiro').value,
                observacoes: document.getElementById('observacoes').value,
                datasStatus: {
                    Ideia: document.getElementById('data-status-ideia').value || '',
                    Roteiro: document.getElementById('data-status-roteiro').value || '',
                    Gravando: document.getElementById('data-status-gravando').value || '',
                    Editando: document.getElementById('data-status-editando').value || '',
                    Agendado: document.getElementById('data-status-agendado').value || '',
                    Publicado: document.getElementById('data-status-publicado').value || ''
                },
                atualizadoEm: new Date().toISOString()
            };
            
            if (idInput && idInput.trim() !== '') {
                const index = conteudos.findIndex(c => String(c.id) === String(idInput));
                if (index !== -1) {
                    data.id = conteudos[index].id;
                    data.criadoEm = conteudos[index].criadoEm;
                    conteudos[index] = data;
                } else {
                    data.id = Date.now().toString();
                    data.criadoEm = new Date().toISOString();
                    conteudos.push(data);
                }
            } else {
                data.id = Date.now().toString();
                data.criadoEm = new Date().toISOString();
                conteudos.push(data);
            }
            
            await saveUserData();
            closeModal();
            navigateTo(currentPage);
            showLoading(false);
        }

        async function deleteContent(id) {
            if (!confirm('Deseja excluir este conteúdo?')) return;
            showLoading(true);
            conteudos = conteudos.filter(c => String(c.id) !== String(id));
            await saveUserData();
            navigateTo(currentPage);
            showLoading(false);
        }

        async function duplicateLastMonth() {
            const meses = [...new Set(conteudos.map(c => c.mes))].sort();
            if (meses.length === 0) {
                alert('Não há meses anteriores para duplicar.');
                return;
            }
            showLoading(true);
            const ultimoMes = meses[meses.length - 1];
            const [ano, mes] = ultimoMes.split('-').map(Number);
            let novoAno = ano, novoMes = mes + 1;
            if (novoMes > 12) { novoMes = 1; novoAno++; }
            const novoMesStr = `${novoAno}-${String(novoMes).padStart(2, '0')}`;
            
            conteudos.filter(c => c.mes === ultimoMes).forEach(c => {
                const novo = { ...c };
                novo.id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
                novo.mes = novoMesStr;
                novo.status = 'Ideia';
                novo.datasStatus = { Ideia: '', Roteiro: '', Gravando: '', Editando: '', Agendado: '', Publicado: '' };
                const data = new Date(c.dataPrevista);
                data.setMonth(data.getMonth() + 1);
                novo.dataPrevista = data.toISOString().split('T')[0];
                novo.criadoEm = new Date().toISOString();
                novo.atualizadoEm = new Date().toISOString();
                conteudos.push(novo);
            });
            
            await saveUserData();
            navigateTo('meses');
            showLoading(false);
        }

        // ==================== DRAG AND DROP ====================
        async function handleDrop(e, newStatus) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            if (draggedItem) {
                const content = conteudos.find(c => String(c.id) === String(draggedItem));
                if (content) {
                    content.status = newStatus;
                    if (!content.datasStatus) content.datasStatus = {};
                    content.datasStatus[newStatus] = new Date().toISOString().split('T')[0];
                    content.atualizadoEm = new Date().toISOString();
                    await saveUserData();
                    renderPipeline(document.getElementById('content-container'));
                }
            }
        }

        function handleDragStart(e, id) { 
            draggedItem = id; 
            e.target.classList.add('dragging'); 
        }
        function handleDragEnd(e) { 
            e.target.classList.remove('dragging'); 
        }
        function handleDragOver(e) { 
            e.preventDefault(); 
            e.currentTarget.classList.add('drag-over'); 
        }
        function handleDragLeave(e) { 
            e.currentTarget.classList.remove('drag-over'); 
        }

        // ==================== RENDER FUNCTIONS ====================
        function navigateTo(page) {
            currentPage = page;
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.dataset.page === page) {
                    item.classList.add('bg-indigo-50', 'dark:bg-indigo-900/30', 'text-indigo-600', 'dark:text-indigo-400', 'border-r-4', 'border-indigo-600');
                    item.classList.remove('text-gray-600', 'dark:text-gray-300');
                } else {
                    item.classList.remove('bg-indigo-50', 'dark:bg-indigo-900/30', 'text-indigo-600', 'dark:text-indigo-400', 'border-r-4', 'border-indigo-600');
                    item.classList.add('text-gray-600', 'dark:text-gray-300');
                }
            });

            const titles = {
                dashboard: 'Dashboard',
                calendario: 'Calendário',
                pipeline: 'Pipeline',
                banco: 'Banco de Conteúdos',
                'banco-dados': 'Banco de Dados',
                metricas: 'Métricas',
                insights: 'Insights (Redes Sociais)',
                marca: 'Marca',
                configuracoes: 'Configurações'
            };
            document.getElementById('page-title').textContent = titles[page] || page;

            const container = document.getElementById('content-container');
            container.innerHTML = '';
            
            switch(page) {
                case 'dashboard': renderDashboard(container); break;
                case 'calendario': renderCalendario(container); break;
                case 'pipeline': renderPipeline(container); break;
                case 'banco': renderBanco(container); break;
                case 'banco-dados': renderBancoDados(container); break;
                case 'metricas': renderMetricas(container); break;
                case 'insights': renderInsights(container); break;
                case 'marca': renderMarca(container); break;
                case 'configuracoes': renderConfiguracoes(container); break;
            }
        }

        // [Continuação das funções de renderização...]
        // As funções renderDashboard, renderCalendario, renderPipeline, renderBanco, 
        // renderBancoDados, renderMetricas, renderInsights permanecem iguais ao original
        
        function renderDashboard(container) {
            const hoje = new Date();
            const mesAtual = hoje.toISOString().slice(0, 7);
            const mesSelecionado = dashboardSelectedMonth || mesAtual;
            const todosMeses = [...new Set(conteudos.map(c => c.mes))].sort().reverse();
            
            const conteudosMes = conteudos.filter(c => c.mes === mesSelecionado);
            const publicados = conteudosMes.filter(c => c.status === 'Publicado');
            const atrasados = conteudos.filter(c => {
                const dataPrev = new Date(c.dataPrevista);
                return dataPrev < hoje && c.status !== 'Publicado';
            });
            const proximaSemana = conteudos.filter(c => {
                const data = new Date(c.dataPrevista);
                const diff = Math.ceil((data - hoje) / (1000 * 60 * 60 * 24));
                return diff >= 0 && diff <= 7 && c.status !== 'Publicado';
            }).sort((a, b) => new Date(a.dataPrevista) - new Date(b.dataPrevista));

            const execucao = conteudosMes.length > 0 ? Math.round((publicados.length / conteudosMes.length) * 100) : 0;
            const funilData = {
                Topo: conteudosMes.filter(c => c.funil === 'Topo').length,
                Meio: conteudosMes.filter(c => c.funil === 'Meio').length,
                Fundo: conteudosMes.filter(c => c.funil === 'Fundo').length
            };

            container.innerHTML = `
                <div class="mb-6">
                    <div class="card rounded-2xl p-4 shadow-sm border flex flex-wrap items-center justify-between gap-4">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-calendar-alt text-indigo-600 text-xl"></i>
                            <span class="font-medium text-gray-700 dark:text-gray-300">Mês selecionado:</span>
                        </div>
                        <select id="dashboard-month-selector" onchange="changeDashboardMonth(this.value)" class="px-4 py-2 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 font-semibold text-gray-900 dark:text-white">
                            ${todosMeses.length === 0 ? `<option value="${mesAtual}" selected>${formatMonth(mesAtual)}</option>` : ''}
                            ${todosMeses.map(m => `<option value="${m}" ${m === mesSelecionado ? 'selected' : ''}>${formatMonth(m)} ${m === mesAtual ? '(Atual)' : ''}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="card rounded-2xl p-6 shadow-sm border">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-xl flex items-center justify-center text-blue-600 dark:text-blue-400"><i class="fas fa-calendar-check text-xl"></i></div>
                            <span class="text-sm text-gray-500 dark:text-gray-400">Total Planejado</span>
                        </div>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">${conteudosMes.length}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">${formatMonth(mesSelecionado)}</p>
                    </div>
                    <div class="card rounded-2xl p-6 shadow-sm border">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-xl flex items-center justify-center text-green-600 dark:text-green-400"><i class="fas fa-check-circle text-xl"></i></div>
                            <span class="text-sm text-gray-500 dark:text-gray-400">Publicados</span>
                        </div>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">${publicados.length}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Conteúdos no ar</p>
                    </div>
                    <div class="card rounded-2xl p-6 shadow-sm border">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-xl flex items-center justify-center text-purple-600 dark:text-purple-400"><i class="fas fa-percentage text-xl"></i></div>
                            <span class="text-sm text-gray-500 dark:text-gray-400">Execução</span>
                        </div>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">${execucao}%</p>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-2"><div class="bg-purple-600 h-2 rounded-full transition-all" style="width: ${execucao}%"></div></div>
                    </div>
                    <div class="card rounded-2xl p-6 shadow-sm border ${atrasados.length > 0 ? 'ring-2 ring-red-100 dark:ring-red-900' : ''}">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 ${atrasados.length > 0 ? 'bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400' : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400'} rounded-xl flex items-center justify-center"><i class="fas fa-exclamation-triangle text-xl"></i></div>
                            <span class="text-sm ${atrasados.length > 0 ? 'text-red-600 font-semibold' : 'text-gray-500 dark:text-gray-400'}">Atrasados</span>
                        </div>
                        <p class="text-3xl font-bold ${atrasados.length > 0 ? 'text-red-600' : 'text-gray-900 dark:text-white'}">${atrasados.length}</p>
                        <p class="text-sm ${atrasados.length > 0 ? 'text-red-500' : 'text-gray-500 dark:text-gray-400'} mt-1">Precisam atenção</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 card rounded-2xl p-6 shadow-sm border">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6">Próximos 7 Dias</h3>
                        <div class="space-y-3">
                            ${proximaSemana.length === 0 ? '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Nenhum conteúdo agendado para esta semana</p>' : ''}
                            ${proximaSemana.map(c => `
                                <div class="flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer" onclick="editContent('${c.id}')">
                                    <div class="w-12 h-12 rounded-lg ${getFunilColor(c.funil)} flex items-center justify-center text-white font-bold">${new Date(c.dataPrevista).getDate()}</div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900 dark:text-white">${c.titulo}</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">${c.canal} • ${c.tipo} • ${c.quadro} • ${c.responsavel}</p>
                                    </div>
                                    <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusClass(c.status)}">${c.status}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="card rounded-2xl p-6 shadow-sm border">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6">Distribuição por Funil</h3>
                        <canvas id="funilChart"></canvas>
                        <div class="mt-6 space-y-3">
                            <div class="flex items-center justify-between"><div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-green-500"></div><span class="text-sm text-gray-600 dark:text-gray-400">Topo</span></div><span class="font-semibold text-gray-900 dark:text-white">${funilData.Topo}</span></div>
                            <div class="flex items-center justify-between"><div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-blue-500"></div><span class="text-sm text-gray-600 dark:text-gray-400">Meio</span></div><span class="font-semibold text-gray-900 dark:text-white">${funilData.Meio}</span></div>
                            <div class="flex items-center justify-between"><div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-red-500"></div><span class="text-sm text-gray-600 dark:text-gray-400">Fundo</span></div><span class="font-semibold text-gray-900 dark:text-white">${funilData.Fundo}</span></div>
                        </div>
                    </div>
                </div>
                ${atrasados.length > 0 ? `
                <div class="mt-8 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-red-800 dark:text-red-400 mb-4 flex items-center gap-2"><i class="fas fa-exclamation-circle"></i>Conteúdos Atrasados</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">${atrasados.map(c => renderContentCard(c)).join('')}</div>
                </div>` : ''}`;

            setTimeout(() => {
                const ctx = document.getElementById('funilChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Topo', 'Meio', 'Fundo'],
                            datasets: [{ data: [funilData.Topo, funilData.Meio, funilData.Fundo], backgroundColor: ['#10b981', '#3b82f6', '#ef4444'], borderWidth: 0 }]
                        },
                        options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { display: false } } }
                    });
                }
            }, 100);
        }

        function changeDashboardMonth(month) {
            dashboardSelectedMonth = month;
            renderDashboard(document.getElementById('content-container'));
        }

        function renderCalendario(container) {
            const ano = currentCalendarDate.getFullYear();
            const mes = currentCalendarDate.getMonth();
            const primeiroDia = new Date(ano, mes, 1);
            const ultimoDia = new Date(ano, mes + 1, 0);
            const diasNoMes = ultimoDia.getDate();
            const diaSemanaInicio = primeiroDia.getDay();
            const mesStr = `${ano}-${String(mes + 1).padStart(2, '0')}`;
            const conteudosMes = conteudos.filter(c => c.mes === mesStr);
            const todosMeses = [...new Set(conteudos.map(c => c.mes))].sort();
            
            let diasHTML = '';
            const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            diasHTML += diasSemana.map(d => `<div class="bg-gray-50 dark:bg-gray-800 p-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-400 border-b border-gray-200 dark:border-gray-700">${d}</div>`).join('');
            for (let i = 0; i < diaSemanaInicio; i++) diasHTML += '<div class="calendar-day bg-gray-50 dark:bg-gray-800/50"></div>';
            
            const hoje = new Date();
            for (let dia = 1; dia <= diasNoMes; dia++) {
                const dataStr = `${ano}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
                const conteudosDia = conteudosMes.filter(c => c.dataPrevista === dataStr);
                const isHoje = dia === hoje.getDate() && mes === hoje.getMonth() && ano === hoje.getFullYear();
                diasHTML += `
                    <div class="calendar-day p-2 ${isHoje ? 'bg-indigo-50 dark:bg-indigo-900/30 ring-2 ring-indigo-200 dark:ring-indigo-700' : ''}">
                        <div class="font-semibold text-sm mb-2 ${isHoje ? 'text-indigo-600 dark:text-indigo-400' : 'text-gray-700 dark:text-gray-300'}">${dia}</div>
                        <div class="space-y-1">${conteudosDia.map(c => `<div onclick="editContent('${c.id}')" class="text-xs p-2 rounded cursor-pointer hover:opacity-80 transition-opacity ${getFunilColor(c.funil)} text-white truncate" title="${c.titulo}"><div class="font-medium truncate">${c.titulo}</div><div class="text-xs opacity-90">${c.canal}</div></div>`).join('')}</div>
                    </div>`;
            }

            container.innerHTML = `
                <div class="card rounded-2xl shadow-sm border overflow-hidden">
                    <div class="p-6 border-b border-gray-100 dark:border-gray-700 flex flex-wrap items-center justify-between gap-4">
                        <div class="flex items-center gap-4">
                            <select id="calendar-month-selector" onchange="jumpToMonth()" class="px-4 py-2 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 font-semibold text-gray-900 dark:text-white">
                                ${todosMeses.length === 0 ? `<option value="${mesStr}" selected>${formatMonth(mesStr)}</option>` : ''}
                                ${todosMeses.map(m => `<option value="${m}" ${m === mesStr ? 'selected' : ''}>${formatMonth(m)}</option>`).join('')}
                            </select>
                            <div class="flex gap-2">
                                <button onclick="changeCalendarMonth(-1)" class="w-10 h-10 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center border border-gray-200 dark:border-gray-600"><i class="fas fa-chevron-left text-gray-600 dark:text-gray-400"></i></button>
                                <button onclick="changeCalendarMonth(1)" class="w-10 h-10 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center border border-gray-200 dark:border-gray-600"><i class="fas fa-chevron-right text-gray-600 dark:text-gray-400"></i></button>
                                <button onclick="goToCurrentMonth()" class="px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 border border-gray-200 dark:border-gray-600 text-sm font-medium text-gray-700 dark:text-gray-300">Hoje</button>
                            </div>
                        </div>
                    </div>
                    <div class="calendar-grid">${diasHTML}</div>
                </div>`;
        }

        function renderPipeline(container) {
            const statusList = ['Ideia', 'Roteiro', 'Gravando', 'Editando', 'Agendado', 'Publicado'];
            container.innerHTML = `
                <div class="flex gap-4 overflow-x-auto pb-4" style="min-height: 600px;">
                    ${statusList.map(status => {
                        const items = conteudos.filter(c => c.status === status);
                        return `
                        <div class="flex-shrink-0 w-80">
                            <div class="bg-gray-100 dark:bg-gray-800 rounded-2xl p-4 h-full">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="font-bold text-gray-700 dark:text-gray-300 flex items-center gap-2"><span class="w-2 h-2 rounded-full ${getStatusDot(status)}"></span>${status}</h3>
                                    <span class="bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 text-xs font-bold px-2 py-1 rounded-full">${items.length}</span>
                                </div>
                                <div class="kanban-column space-y-3" ondragover="handleDragOver(event)" ondrop="handleDrop(event, '${status}')" ondragleave="handleDragLeave(event)">
                                    ${items.length === 0 ? '<p class="text-center text-gray-400 dark:text-gray-500 py-8 text-sm">Nenhum item</p>' : ''}
                                    ${items.map(c => `
                                        <div draggable="true" ondragstart="handleDragStart(event, '${c.id}')" ondragend="handleDragEnd(event)" class="card rounded-xl p-4 shadow-sm border cursor-move hover:shadow-md transition-shadow priority-${c.prioridade}" onclick="editContent('${c.id}')">
                                            <div class="flex justify-between items-start mb-2"><span class="text-xs font-medium px-2 py-1 rounded ${getFunilBadge(c.funil)}">${c.funil}</span><span class="text-xs text-gray-400 dark:text-gray-500">${c.responsavel}</span></div>
                                            <h4 class="font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2">${c.titulo}</h4>
                                            <div class="text-xs text-gray-500 dark:text-gray-400">${c.canal} • ${formatDate(c.dataPrevista)}</div>
                                        </div>`).join('')}
                                </div>
                            </div>
                        </div>`;
                    }).join('')}
                </div>`;
        }

        function renderBanco(container) {
            container.innerHTML = `
                <div class="card rounded-2xl shadow-sm border overflow-hidden">
                    <div class="p-4 border-b border-gray-100 dark:border-gray-700 flex flex-wrap gap-4 items-center">
                        <input type="text" id="banco-search" placeholder="Buscar..." class="px-4 py-2 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" onkeyup="filterBanco()">
                        <select id="banco-filter-status" onchange="filterBanco()" class="px-4 py-2 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg">
                            <option value="">Todos os Status</option>
                            <option value="Ideia">Ideia</option>
                            <option value="Roteiro">Roteiro</option>
                            <option value="Gravando">Gravando</option>
                            <option value="Editando">Editando</option>
                            <option value="Agendado">Agendado</option>
                            <option value="Publicado">Publicado</option>
                        </select>
                        <select id="banco-filter-canal" onchange="filterBanco()" class="px-4 py-2 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg">
                            <option value="">Todos os Canais</option>
                            ${userSettings.canais.map(c => `<option value="${c}">${c}</option>`).join('')}
                        </select>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-400 text-sm uppercase">
                                <tr>
                                    <th class="px-6 py-3">Título</th>
                                    <th class="px-6 py-3">Canal</th>
                                    <th class="px-6 py-3">Tipo</th>
                                    <th class="px-6 py-3">Status</th>
                                    <th class="px-6 py-3">Data</th>
                                    <th class="px-6 py-3">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="banco-table-body" class="divide-y divide-gray-100 dark:divide-gray-700">
                                ${conteudos.length === 0 ? '<tr><td colspan="6" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400"><i class="fas fa-inbox text-4xl mb-4 block"></i>Nenhum conteúdo cadastrado</td></tr>' : 
                                conteudos.sort((a, b) => new Date(b.dataPrevista) - new Date(a.dataPrevista)).map(c => `
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50">
                                        <td class="px-6 py-4 font-medium text-gray-900 dark:text-white">${c.titulo}</td>
                                        <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${c.canal}</td>
                                        <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${c.tipo}</td>
                                        <td class="px-6 py-4"><span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(c.status)}">${c.status}</span></td>
                                        <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${formatDate(c.dataPrevista)}</td>
                                        <td class="px-6 py-4">
                                            <button onclick="editContent('${c.id}')" class="text-indigo-600 hover:text-indigo-800 mr-3"><i class="fas fa-edit"></i></button>
                                            <button onclick="deleteContent('${c.id}')" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>`;
        }

        function renderBancoDados(container) {
            container.innerHTML = `
                <div class="max-w-6xl mx-auto space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="card rounded-2xl p-6 shadow-sm border">
                            <div class="flex items-center gap-3 mb-2">
                                <i class="fas fa-file-alt text-blue-500"></i>
                                <span class="text-sm text-gray-500 dark:text-gray-400">Total de Conteúdos</span>
                            </div>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${conteudos.length}</p>
                        </div>
                        <div class="card rounded-2xl p-6 shadow-sm border">
                            <div class="flex items-center gap-3 mb-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                <span class="text-sm text-gray-500 dark:text-gray-400">Publicados</span>
                            </div>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${conteudos.filter(c => c.status === 'Publicado').length}</p>
                        </div>
                        <div class="card rounded-2xl p-6 shadow-sm border">
                            <div class="flex items-center gap-3 mb-2">
                                <i class="fas fa-clock text-yellow-500"></i>
                                <span class="text-sm text-gray-500 dark:text-gray-400">Em Produção</span>
                            </div>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${conteudos.filter(c => ['Roteiro', 'Gravando', 'Editando'].includes(c.status)).length}</p>
                        </div>
                        <div class="card rounded-2xl p-6 shadow-sm border">
                            <div class="flex items-center gap-3 mb-2">
                                <i class="fas fa-lightbulb text-purple-500"></i>
                                <span class="text-sm text-gray-500 dark:text-gray-400">Ideias</span>
                            </div>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">${conteudos.filter(c => c.status === 'Ideia').length}</p>
                        </div>
                    </div>

                    <div class="card rounded-2xl p-6 shadow-sm border">
                        <h4 class="font-bold text-gray-900 dark:text-white mb-4">Ações em Massa</h4>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="exportAllData()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-download mr-2"></i>Exportar Tudo (JSON)
                            </button>
                            <button onclick="exportToCSV()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-file-csv mr-2"></i>Exportar para CSV
                            </button>
                            <label class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors cursor-pointer">
                                <i class="fas fa-upload mr-2"></i>Importar Dados
                                <input type="file" id="import-all-file" accept=".json" class="hidden" onchange="importAllData(this)">
                            </label>
                        </div>
                    </div>

                    <div class="card rounded-2xl shadow-sm border overflow-hidden">
                        <div class="p-4 border-b border-gray-100 dark:border-gray-700 flex flex-wrap gap-4 items-center">
                            <input type="text" id="banco-dados-search" placeholder="Buscar conteúdos..." class="px-4 py-2 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" onkeyup="filterBancoDados()">
                            <select id="banco-dados-filter-status" onchange="filterBancoDados()" class="px-4 py-2 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg">
                                <option value="">Todos os Status</option>
                                <option value="Ideia">Ideia</option>
                                <option value="Roteiro">Roteiro</option>
                                <option value="Gravando">Gravando</option>
                                <option value="Editando">Editando</option>
                                <option value="Agendado">Agendado</option>
                                <option value="Publicado">Publicado</option>
                            </select>
                            <select id="banco-dados-filter-canal" onchange="filterBancoDados()" class="px-4 py-2 border border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg">
                                <option value="">Todos os Canais</option>
                                ${userSettings.canais.map(c => `<option value="${c}">${c}</option>`).join('')}
                            </select>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-400 text-sm uppercase">
                                    <tr>
                                        <th class="px-6 py-3">Título</th>
                                        <th class="px-6 py-3">Canal</th>
                                        <th class="px-6 py-3">Status</th>
                                        <th class="px-6 py-3">Data Prevista</th>
                                        <th class="px-6 py-3">Responsável</th>
                                        <th class="px-6 py-3">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="banco-dados-table-body" class="divide-y divide-gray-100 dark:divide-gray-700">
                                    ${conteudos.length === 0 ? '<tr><td colspan="6" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400"><i class="fas fa-inbox text-4xl mb-4 block"></i>Nenhum conteúdo cadastrado</td></tr>' : 
                                    conteudos.sort((a, b) => new Date(b.dataPrevista) - new Date(a.dataPrevista)).map(c => `
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50">
                                            <td class="px-6 py-4">
                                                <p class="font-medium text-gray-900 dark:text-white">${c.titulo}</p>
                                                <p class="text-xs text-gray-500">${c.tipo} • ${c.quadro}</p>
                                            </td>
                                            <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${c.canal}</td>
                                            <td class="px-6 py-4"><span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(c.status)}">${c.status}</span></td>
                                            <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${formatDate(c.dataPrevista)}</td>
                                            <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${c.responsavel}</td>
                                            <td class="px-6 py-4">
                                                <button onclick="editContent('${c.id}')" class="text-indigo-600 hover:text-indigo-800 mr-3"><i class="fas fa-edit"></i></button>
                                                <button onclick="deleteContent('${c.id}')" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>`;
        }

        function renderMetricas(container) {
            const hoje = new Date();
            const mesAtual = hoje.toISOString().slice(0, 7);
            const conteudosMes = conteudos.filter(c => c.mes === mesAtual);
            const porCanal = {};
            const porFunil = { Topo: 0, Meio: 0, Fundo: 0 };
            const porResponsavel = {};
            const porStatus = {};
            
            conteudosMes.forEach(c => {
                porCanal[c.canal] = (porCanal[c.canal] || 0) + 1;
                porFunil[c.funil]++;
                porResponsavel[c.responsavel] = (porResponsavel[c.responsavel] || 0) + 1;
                porStatus[c.status] = (porStatus[c.status] || 0) + 1;
            });

            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="card rounded-2xl p-6 shadow-sm border"><h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Conteúdos por Canal</h3><canvas id="chartCanal"></canvas></div>
                    <div class="card rounded-2xl p-6 shadow-sm border"><h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Distribuição por Funil</h3><canvas id="chartFunil"></canvas></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card rounded-2xl p-6 shadow-sm border"><h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Por Responsável</h3><canvas id="chartResponsavel"></canvas></div>
                    <div class="card rounded-2xl p-6 shadow-sm border"><h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Por Status</h3><canvas id="chartStatus"></canvas></div>
                </div>`;

            setTimeout(() => {
                if (Object.keys(porCanal).length > 0) {
                    new Chart(document.getElementById('chartCanal'), { type: 'bar', data: { labels: Object.keys(porCanal), datasets: [{ label: 'Conteúdos', data: Object.values(porCanal), backgroundColor: '#6366f1', borderRadius: 6 }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } } });
                }
                new Chart(document.getElementById('chartFunil'), { type: 'pie', data: { labels: ['Topo', 'Meio', 'Fundo'], datasets: [{ data: [porFunil.Topo, porFunil.Meio, porFunil.Fundo], backgroundColor: ['#10b981', '#3b82f6', '#ef4444'] }] } });
                if (Object.keys(porResponsavel).length > 0) {
                    new Chart(document.getElementById('chartResponsavel'), { type: 'doughnut', data: { labels: Object.keys(porResponsavel), datasets: [{ data: Object.values(porResponsavel), backgroundColor: ['#8b5cf6', '#ec4899', '#f59e0b', '#10b981'] }] } });
                }
                if (Object.keys(porStatus).length > 0) {
                    new Chart(document.getElementById('chartStatus'), { type: 'bar', data: { labels: Object.keys(porStatus), datasets: [{ label: 'Conteúdos', data: Object.values(porStatus), backgroundColor: ['#6b7280', '#3b82f6', '#f59e0b', '#ec4899', '#10b981', '#6366f1'], borderRadius: 6 }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } } });
                }
            }, 100);
        }

        function renderInsights(container) {
            container.innerHTML = `
                <div class="max-w-6xl mx-auto space-y-8">
                    <div class="card rounded-2xl p-6 shadow-sm border">
                        <div class="flex flex-wrap items-center justify-between gap-4">
                            <div>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                    <i class="fab fa-meta text-blue-600"></i>
                                    Integração Meta (Instagram/Facebook)
                                </h3>
                            </div>
                            <div class="flex items-center gap-3">
                                <button onclick="updateInsightsData()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                                    <i class="fas fa-sync mr-2"></i>Atualizar Dados
                                </button>
                            </div>
                        </div>
                        <div class="mt-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Token de Acesso Meta API</label>
                            <div class="flex gap-3">
                                <input type="password" id="meta-token" value="${insightsData.metaToken || ''}" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="Cole seu token de acesso aqui">
                                <button onclick="saveMetaToken()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                    <i class="fas fa-save mr-1"></i> Salvar
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="card rounded-2xl p-6 shadow-sm border">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-xl flex items-center justify-center text-blue-600 dark:text-blue-400"><i class="fas fa-eye text-xl"></i></div>
                                <span class="text-sm text-gray-500 dark:text-gray-400">Alcance Total</span>
                            </div>
                            <p class="text-3xl font-bold text-gray-900 dark:text-white">${insightsData.visaoMacro?.alcanceTotal?.toLocaleString() || '0'}</p>
                        </div>
                        <div class="card rounded-2xl p-6 shadow-sm border">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-xl flex items-center justify-center text-purple-600 dark:text-purple-400"><i class="fas fa-desktop text-xl"></i></div>
                                <span class="text-sm text-gray-500 dark:text-gray-400">Impressões</span>
                            </div>
                            <p class="text-3xl font-bold text-gray-900 dark:text-white">${insightsData.visaoMacro?.impressoesTotal?.toLocaleString() || '0'}</p>
                        </div>
                        <div class="card rounded-2xl p-6 shadow-sm border">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-xl flex items-center justify-center text-green-600 dark:text-green-400"><i class="fas fa-percentage text-xl"></i></div>
                                <span class="text-sm text-gray-500 dark:text-gray-400">Engajamento Médio</span>
                            </div>
                            <p class="text-3xl font-bold text-gray-900 dark:text-white">${insightsData.visaoMacro?.engajamentoMedio || '0'}%</p>
                        </div>
                        <div class="card rounded-2xl p-6 shadow-sm border">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-pink-100 dark:bg-pink-900 rounded-xl flex items-center justify-center text-pink-600 dark:text-pink-400"><i class="fas fa-users text-xl"></i></div>
                                <span class="text-sm text-gray-500 dark:text-gray-400">Novos Seguidores</span>
                            </div>
                            <p class="text-3xl font-bold text-gray-900 dark:text-white">+${insightsData.visaoMacro?.crescimentoSeguidores?.toLocaleString() || '0'}</p>
                        </div>
                    </div>

                    <div class="card rounded-2xl shadow-sm border overflow-hidden">
                        <div class="p-6 border-b border-gray-100 dark:border-gray-700">
                            <h3 class="text-lg font-bold text-gray-900 dark:text-white">Performance por Conteúdo</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-400 text-sm uppercase">
                                    <tr>
                                        <th class="px-6 py-3">Conteúdo</th>
                                        <th class="px-6 py-3">Canal</th>
                                        <th class="px-6 py-3 text-right">Alcance</th>
                                        <th class="px-6 py-3 text-right">Curtidas</th>
                                        <th class="px-6 py-3 text-right">Engajamento</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                                    ${insightsData.conteudos?.length > 0 ? insightsData.conteudos.map(c => `
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50">
                                            <td class="px-6 py-4"><p class="font-medium text-gray-900 dark:text-white">${c.titulo}</p></td>
                                            <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${c.canal}</td>
                                            <td class="px-6 py-4 text-right font-medium">${c.alcance?.toLocaleString() || '0'}</td>
                                            <td class="px-6 py-4 text-right">${c.curtidas?.toLocaleString() || '0'}</td>
                                            <td class="px-6 py-4 text-right"><span class="px-2 py-1 rounded-full text-xs font-medium ${c.engajamento > 5 ? 'bg-green-100 text-green-700' : c.engajamento > 2 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}">${c.engajamento}%</span></td>
                                        </tr>
                                    `).join('') : '<tr><td colspan="5" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400"><i class="fas fa-chart-line text-4xl mb-4 block text-gray-300"></i><p>Nenhum dado de performance importado</p></td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>`;
        }

        // ==================== NOVA FUNÇÃO: RENDER MARCA COM UPLOAD ====================
        function renderMarca(container) {
            const sections = [
                { id: 'fundamentos', title: 'Fundamentos', icon: 'fa-bullseye', fields: [
                    { key: 'proposito', label: 'Propósito', placeholder: 'Por que a marca existe?' },
                    { key: 'missao', label: 'Missão', placeholder: 'O que a marca busca realizar?' },
                    { key: 'visao', label: 'Visão', placeholder: 'Onde a marca quer chegar?' },
                    { key: 'valores', label: 'Valores', placeholder: 'Princípios que guiam a marca' },
                    { key: 'posicionamento', label: 'Posicionamento', placeholder: 'Como a marca se posiciona no mercado' },
                    { key: 'promessa', label: 'Promessa', placeholder: 'O que a marca promete entregar' },
                    { key: 'diferencial', label: 'Diferencial', placeholder: 'O que diferencia a marca' }
                ]},
                { id: 'publico', title: 'Público & Persona', icon: 'fa-users', fields: [
                    { key: 'publicoAlvo', label: 'Público-alvo', placeholder: 'Descrição detalhada do público' },
                    { key: 'persona', label: 'Persona Principal', placeholder: 'Nome, idade, profissão, comportamento...' },
                    { key: 'dores', label: 'Dores', placeholder: 'Problemas que o público enfrenta' },
                    { key: 'desejos', label: 'Desejos', placeholder: 'O que o público aspira' },
                    { key: 'linguagem', label: 'Linguagem', placeholder: 'Como o público se comunica' },
                    { key: 'objecoes', label: 'Objeções', placeholder: 'Possíveis resistências do público' }
                ]},
                { id: 'estrategia', title: 'Estratégia', icon: 'fa-chess', fields: [
                    { key: 'planejamentoAnual', label: 'Planejamento Anual', placeholder: 'Objetivos e metas do ano' },
                    { key: 'metaCrescimento', label: 'Meta de Crescimento', placeholder: 'Métricas de crescimento esperadas' },
                    { key: 'estrategiaFunil', label: 'Estratégia de Funil', placeholder: 'Como abordar cada etapa do funil' },
                    { key: 'estrategiaMonetizacao', label: 'Estratégia de Monetização', placeholder: 'Como a marca gera receita' },
                    { key: 'frequenciaCanal', label: 'Frequência Ideal por Canal', placeholder: 'Quantidade de posts por canal/semana' }
                ]},
                { id: 'identidade', title: 'Identidade', icon: 'fa-fingerprint', fields: [
                    { key: 'arquetipo', label: 'Arquétipo', placeholder: 'Ex: Criador, Herói, Sábio...' },
                    { key: 'tomVoz', label: 'Tom de Voz', placeholder: 'Formal, descontraído, técnico...' },
                    { key: 'palavrasPermitidas', label: 'Palavras Permitidas', placeholder: 'Termos que a marca usa' },
                    { key: 'palavrasProibidas', label: 'Palavras Proibidas', placeholder: 'Termos que a marca evita' },
                    { key: 'manualVisual', label: 'Manual Visual (URL do PDF)', placeholder: 'Link para o manual da marca' },
                    { key: 'cores', label: 'Cores', placeholder: 'Paleta de cores da marca' },
                    { key: 'tipografia', label: 'Tipografia', placeholder: 'Fontes utilizadas' }
                ]},
                { id: 'cultura', title: 'Cultura', icon: 'fa-heart', fields: [
                    { key: 'playlistSpotify', label: 'Playlist Spotify (URL)', placeholder: 'Link da playlist que representa a marca' },
                    { key: 'referencias', label: 'Referências', placeholder: 'Marcas, pessoas ou conteúdos de referência' },
                    { key: 'manifesto', label: 'Manifesto', placeholder: 'Declaração de propósito da marca' }
                ]}
            ];

            container.innerHTML = `
                <div class="max-w-5xl mx-auto space-y-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Estratégia de Marca</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Documentação completa da identidade e estratégia da marca</p>
                        </div>
                        <button onclick="saveMarcaData()" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2">
                            <i class="fas fa-save"></i> Salvar Alterações
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        ${sections.map(section => `
                            <div class="card rounded-2xl shadow-sm border overflow-hidden">
                                <button onclick="toggleSection('${section.id}')" class="w-full px-6 py-4 flex items-center justify-between bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-indigo-100 dark:bg-indigo-900 rounded-xl flex items-center justify-center text-indigo-600 dark:text-indigo-400">
                                            <i class="fas ${section.icon}"></i>
                                        </div>
                                        <h4 class="font-bold text-gray-900 dark:text-white">${section.title}</h4>
                                    </div>
                                    <i class="fas fa-chevron-down text-gray-400 transition-transform" id="icon-${section.id}"></i>
                                </button>
                                <div id="section-${section.id}" class="hidden border-t border-gray-100 dark:border-gray-700">
                                    <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                                        ${section.fields.map(field => `
                                            <div class="${field.key === 'manifesto' || field.key === 'planejamentoAnual' ? 'md:col-span-2' : ''}">
                                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">${field.label}</label>
                                                <textarea id="marca-${section.id}-${field.key}" rows="${field.key === 'manifesto' || field.key === 'planejamentoAnual' ? '6' : '3'}" 
                                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none" 
                                                    placeholder="${field.placeholder}">${marcaData[section.id]?.[field.key] || ''}</textarea>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- NOVA SEÇÃO: UPLOAD DE ARQUIVOS PDF -->
                    <div class="card rounded-2xl shadow-sm border overflow-hidden mt-8">
                        <div class="p-6 border-b border-gray-100 dark:border-gray-700 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-indigo-100 dark:bg-indigo-900 rounded-xl flex items-center justify-center text-indigo-600 dark:text-indigo-400">
                                    <i class="fas fa-file-pdf text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-900 dark:text-white text-lg">Arquivos da Marca</h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Upload de PDFs (máx. 60MB por arquivo)</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <!-- Zona de Upload -->
                            <div id="upload-zone" class="upload-zone mb-6" ondrop="handleFileDrop(event)" ondragover="handleFileDragOver(event)" ondragleave="handleFileDragLeave(event)" onclick="document.getElementById('file-input').click()">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                <p class="text-gray-600 dark:text-gray-300 font-medium mb-1">Arraste arquivos PDF aqui</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">ou clique para selecionar</p>
                                <p class="text-xs text-gray-400 mt-2">Máximo 60MB por arquivo • Múltiplos arquivos permitidos</p>
                                <input type="file" id="file-input" class="hidden" accept=".pdf" multiple onchange="handleFileSelect(event)">
                            </div>

                            <!-- Lista de Arquivos -->
                            <div id="arquivos-lista" class="space-y-3">
                                ${marcaData.arquivos && marcaData.arquivos.length > 0 ? 
                                    marcaData.arquivos.map((arquivo, index) => renderArquivoItem(arquivo, index)).join('') : 
                                    '<p class="text-center text-gray-500 dark:text-gray-400 py-4" id="no-files-msg">Nenhum arquivo enviado ainda</p>'
                                }
                            </div>
                        </div>
                    </div>
                </div>`;
        }

        // Função auxiliar para renderizar item de arquivo
        function renderArquivoItem(arquivo, index) {
            return `
                <div class="file-item" id="file-${index}">
                    <div class="flex items-center gap-3 flex-1">
                        <div class="w-10 h-10 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center text-red-600 dark:text-red-400">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-medium text-gray-900 dark:text-white truncate">${arquivo.nome}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">${formatFileSize(arquivo.tamanho)} • ${formatDate(arquivo.dataUpload)}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <a href="${arquivo.url}" target="_blank" class="px-3 py-1.5 bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-800 transition-colors text-sm font-medium">
                            <i class="fas fa-eye mr-1"></i> Abrir
                        </a>
                        <button onclick="removerArquivo(${index})" class="px-3 py-1.5 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-lg hover:bg-red-200 dark:hover:bg-red-800 transition-colors text-sm font-medium">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        // Funções de Upload de Arquivos
        function handleFileDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleFileDragLeave(e) {
            e.currentTarget.classList.remove('dragover');
        }

        function handleFileDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
            if (files.length > 0) {
                uploadFiles(files);
            } else {
                alert('Por favor, arraste apenas arquivos PDF.');
            }
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                uploadFiles(files);
            }
        }

        async function uploadFiles(files) {
            if (!currentUser) {
                alert('Você precisa estar logado para fazer upload.');
                return;
            }

            const maxSize = 60 * 1024 * 1024; // 60MB
            const validFiles = files.filter(f => {
                if (f.size > maxSize) {
                    alert(`Arquivo "${f.name}" excede o limite de 60MB.`);
                    return false;
                }
                if (f.type !== 'application/pdf') {
                    alert(`Arquivo "${f.name}" não é um PDF válido.`);
                    return false;
                }
                return true;
            });

            if (validFiles.length === 0) return;

            showLoading(true);

            for (const file of validFiles) {
                try {
                    // Criar referência única no Storage
                    const timestamp = Date.now();
                    const fileName = `${timestamp}_${file.name}`;
                    const storageRef = storage.ref(`marcas/${currentUser.id}/arquivos/${fileName}`);
                    
                    // Upload com monitoramento de progresso
                    const uploadTask = storageRef.put(file);
                    
                    // Criar elemento de progresso temporário
                    const progressId = `progress-${timestamp}`;
                    const tempHtml = `
                        <div class="file-item" id="${progressId}">
                            <div class="flex items-center gap-3 flex-1">
                                <div class="w-10 h-10 bg-indigo-100 dark:bg-indigo-900 rounded-lg flex items-center justify-center text-indigo-600 dark:text-indigo-400 animate-pulse">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900 dark:text-white">${file.name}</p>
                                    <div class="progress-bar"><div class="progress-fill" id="progress-bar-${timestamp}" style="width: 0%"></div></div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    const lista = document.getElementById('arquivos-lista');
                    const noFilesMsg = document.getElementById('no-files-msg');
                    if (noFilesMsg) noFilesMsg.remove();
                    
                    lista.insertAdjacentHTML('afterbegin', tempHtml);
                    
                    // Monitorar progresso
                    uploadTask.on('state_changed', 
                        (snapshot) => {
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            document.getElementById(`progress-bar-${timestamp}`).style.width = progress + '%';
                        },
                        (error) => {
                            console.error('Erro no upload:', error);
                            alert(`Erro ao enviar ${file.name}: ${error.message}`);
                            document.getElementById(progressId).remove();
                        },
                        async () => {
                            // Upload completo
                            const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                            
                            // Adicionar aos dados
                            const arquivoData = {
                                nome: file.name,
                                url: downloadURL,
                                tamanho: file.size,
                                dataUpload: new Date().toISOString(),
                                path: `marcas/${currentUser.id}/arquivos/${fileName}`
                            };
                            
                            marcaData.arquivos.push(arquivoData);
                            await saveUserData();
                            
                            // Remover progresso e adicionar item final
                            document.getElementById(progressId).remove();
                            const index = marcaData.arquivos.length - 1;
                            lista.insertAdjacentHTML('afterbegin', renderArquivoItem(arquivoData, index));
                        }
                    );
                    
                } catch (error) {
                    console.error('Erro:', error);
                    alert(`Erro ao processar ${file.name}: ${error.message}`);
                }
            }
            
            showLoading(false);
        }

        async function removerArquivo(index) {
            if (!confirm('Deseja remover este arquivo?')) return;
            
            showLoading(true);
            try {
                const arquivo = marcaData.arquivos[index];
                if (arquivo && arquivo.path) {
                    // Deletar do Storage
                    await storage.ref(arquivo.path).delete();
                }
                
                // Remover do array
                marcaData.arquivos.splice(index, 1);
                await saveUserData();
                
                // Re-renderizar lista
                const lista = document.getElementById('arquivos-lista');
                if (marcaData.arquivos.length === 0) {
                    lista.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 py-4" id="no-files-msg">Nenhum arquivo enviado ainda</p>';
                } else {
                    lista.innerHTML = marcaData.arquivos.map((a, i) => renderArquivoItem(a, i)).join('');
                }
                
            } catch (error) {
                console.error('Erro ao remover:', error);
                alert('Erro ao remover arquivo: ' + error.message);
            }
            showLoading(false);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // ==================== NOVA FUNÇÃO: RENDER CONFIGURAÇÕES ====================
        function renderConfiguracoes(container) {
            container.innerHTML = `
                <div class="max-w-4xl mx-auto space-y-8">
                    <!-- Aparência -->
                    <div class="card rounded-2xl p-6 shadow-sm border">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2">
                            <i class="fas fa-palette text-indigo-600"></i>Aparência
                        </h3>
                        <div class="flex items-center justify-between py-4">
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">Tema Escuro</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Alternar entre tema claro e escuro</p>
                            </div>
                            <div class="toggle-switch ${userSettings.theme === 'dark' ? 'active' : ''}" onclick="toggleThemeSwitch(this)"></div>
                        </div>
                    </div>

                    <!-- Perfil -->
                    <div class="card rounded-2xl p-6 shadow-sm border">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2">
                            <i class="fas fa-user text-indigo-600"></i>Perfil
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome</label>
                                <input type="text" id="config-name" value="${currentUser?.name || ''}" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                                <input type="email" value="${currentUser?.email || ''}" disabled class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 text-gray-500 rounded-lg bg-gray-50 dark:bg-gray-800">
                            </div>
                        </div>
                        <button onclick="updateProfile()" class="mt-4 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">Salvar Alterações</button>
                    </div>

                    <!-- Configurações de Conteúdo Editáveis -->
                    <div class="card rounded-2xl p-6 shadow-sm border">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2">
                            <i class="fas fa-list text-indigo-600"></i>Configurações de Conteúdo
                        </h3>
                        
                        <!-- Canais -->
                        <div class="mb-8">
                            <div class="flex items-center justify-between mb-3">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Canais</label>
                                <button onclick="addEditableItem('canais')" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
                                    <i class="fas fa-plus mr-1"></i>Adicionar
                                </button>
                            </div>
                            <div id="editable-canais" class="space-y-2">
                                ${renderEditableList('canais', userSettings.canais)}
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Estes canais aparecerão nas opções ao criar conteúdo</p>
                        </div>

                        <!-- Tipos -->
                        <div class="mb-8">
                            <div class="flex items-center justify-between mb-3">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Tipos de Conteúdo</label>
                                <button onclick="addEditableItem('tipos')" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
                                    <i class="fas fa-plus mr-1"></i>Adicionar
                                </button>
                            </div>
                            <div id="editable-tipos" class="space-y-2">
                                ${renderEditableList('tipos', userSettings.tipos)}
                            </div>
                        </div>

                        <!-- Quadros -->
                        <div class="mb-8">
                            <div class="flex items-center justify-between mb-3">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Quadros / Temas</label>
                                <button onclick="addEditableItem('quadros')" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
                                    <i class="fas fa-plus mr-1"></i>Adicionar
                                </button>
                            </div>
                            <div id="editable-quadros" class="space-y-2">
                                ${renderEditableList('quadros', userSettings.quadros)}
                            </div>
                        </div>

                        <!-- Objetivos -->
                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-3">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Objetivos</label>
                                <button onclick="addEditableItem('objetivos')" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
                                    <i class="fas fa-plus mr-1"></i>Adicionar
                                </button>
                            </div>
                            <div id="editable-objetivos" class="space-y-2">
                                ${renderEditableList('objetivos', userSettings.objetivos)}
                            </div>
                        </div>

                        <button onclick="saveContentOptions()" class="w-full px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium">
                            <i class="fas fa-save mr-2"></i>Salvar Todas as Configurações
                        </button>
                    </div>

                    <!-- Dados -->
                    <div class="card rounded-2xl p-6 shadow-sm border">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2">
                            <i class="fas fa-database text-indigo-600"></i>Dados
                        </h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between py-3 border-b border-gray-100 dark:border-gray-700">
                                <div>
                                    <p class="font-medium text-gray-900 dark:text-white">Exportar Dados</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Baixar todos os conteúdos em JSON</p>
                                </div>
                                <button onclick="exportData()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                    <i class="fas fa-download mr-2"></i>Exportar
                                </button>
                            </div>
                            <div class="flex items-center justify-between py-3 border-b border-gray-100 dark:border-gray-700">
                                <div>
                                    <p class="font-medium text-gray-900 dark:text-white">Importar Dados</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Carregar conteúdos de um arquivo JSON</p>
                                </div>
                                <label class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer">
                                    <i class="fas fa-upload mr-2"></i>Importar
                                    <input type="file" id="import-file" accept=".json" class="hidden" onchange="importData(this)">
                                </label>
                            </div>
                            <div class="flex items-center justify-between py-3">
                                <div>
                                    <p class="font-medium text-red-600">Limpar Todos os Dados</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Excluir permanentemente todos os conteúdos</p>
                                </div>
                                <button onclick="clearAllData()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                    <i class="fas fa-trash mr-2"></i>Limpar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>`;
        }

        // Funções auxiliares para lista editável
        function renderEditableList(tipo, items) {
            if (!items || items.length === 0) return '<p class="text-sm text-gray-400 italic">Nenhum item cadastrado</p>';
            
            return items.map((item, index) => `
                <div class="editable-list-item" data-index="${index}" data-tipo="${tipo}">
                    <input type="text" value="${item}" onchange="updateEditableItem('${tipo}', ${index}, this.value)" class="bg-transparent">
                    <button onclick="removeEditableItem('${tipo}', ${index})" class="text-red-500 hover:text-red-700 p-1">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function addEditableItem(tipo) {
            const container = document.getElementById(`editable-${tipo}`);
            const novoItem = document.createElement('div');
            novoItem.className = 'editable-list-item';
            novoItem.innerHTML = `
                <input type="text" value="" placeholder="Novo item..." class="bg-transparent" onblur="saveNewItem('${tipo}', this)" onkeypress="if(event.key==='Enter'){this.blur();}">
                <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-700 p-1">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(novoItem);
            novoItem.querySelector('input').focus();
        }

        function saveNewItem(tipo, input) {
            const valor = input.value.trim();
            if (valor) {
                if (!userSettings[tipo]) userSettings[tipo] = [];
                userSettings[tipo].push(valor);
                // Re-renderizar
                document.getElementById(`editable-${tipo}`).innerHTML = renderEditableList(tipo, userSettings[tipo]);
                // Salvar automaticamente
                saveUserSettings();
            } else {
                input.parentElement.remove();
            }
        }

        function updateEditableItem(tipo, index, valor) {
            if (userSettings[tipo] && userSettings[tipo][index] !== undefined) {
                userSettings[tipo][index] = valor.trim();
                saveUserSettings();
            }
        }

        function removeEditableItem(tipo, index) {
            if (confirm('Remover este item?')) {
                if (userSettings[tipo]) {
                    userSettings[tipo].splice(index, 1);
                    document.getElementById(`editable-${tipo}`).innerHTML = renderEditableList(tipo, userSettings[tipo]);
                    saveUserSettings();
                }
            }
        }

        // ==================== FUNÇÕES AUXILIARES ====================
        function toggleSection(sectionId) {
            const section = document.getElementById(`section-${sectionId}`);
            const icon = document.getElementById(`icon-${sectionId}`);
            if (section.classList.contains('hidden')) {
                section.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                section.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        async function saveMarcaData() {
            const sections = ['fundamentos', 'publico', 'estrategia', 'identidade', 'cultura'];
            sections.forEach(section => {
                const fields = document.querySelectorAll(`[id^="marca-${section}-"]`);
                fields.forEach(field => {
                    const key = field.id.replace(`marca-${section}-`, '');
                    if (!marcaData[section]) marcaData[section] = {};
                    marcaData[section][key] = field.value;
                });
            });
            
            if (!currentUser) return;
            showLoading(true);
            try {
                await db.collection('conteudos').doc(currentUser.id).update({
                    marca: marcaData,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert('Dados da marca salvos com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar dados da marca:', error);
                alert('Erro ao salvar dados da marca');
            }
            showLoading(false);
        }

        async function saveMetaToken() {
            const token = document.getElementById('meta-token').value;
            insightsData.metaToken = token;
            if (!currentUser) return;
            try {
                await db.collection('conteudos').doc(currentUser.id).update({
                    insights: insightsData,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert('Token salvo com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar token:', error);
                alert('Erro ao salvar token');
            }
        }

        async function updateInsightsData() {
            showLoading(true);
            setTimeout(() => {
                alert('Funcionalidade de integração com Meta API será implementada.\n\nPor enquanto, os dados podem ser inseridos manualmente no banco de dados.');
                showLoading(false);
            }, 1000);
        }

        function filterBancoDados() {
            const search = document.getElementById('banco-dados-search')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('banco-dados-filter-status')?.value || '';
            const canalFilter = document.getElementById('banco-dados-filter-canal')?.value || '';
            
            const filtered = conteudos.filter(c => {
                const matchesSearch = c.titulo.toLowerCase().includes(search);
                const matchesStatus = !statusFilter || c.status === statusFilter;
                const matchesCanal = !canalFilter || c.canal === canalFilter;
                return matchesSearch && matchesStatus && matchesCanal;
            });
            
            const tbody = document.getElementById('banco-dados-table-body');
            if (!tbody) return;
            
            tbody.innerHTML = filtered.length === 0 ? 
                '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">Nenhum resultado encontrado</td></tr>' : 
                filtered.sort((a, b) => new Date(b.dataPrevista) - new Date(a.dataPrevista)).map(c => `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50">
                        <td class="px-6 py-4"><p class="font-medium text-gray-900 dark:text-white">${c.titulo}</p><p class="text-xs text-gray-500">${c.tipo} • ${c.quadro}</p></td>
                        <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${c.canal}</td>
                        <td class="px-6 py-4"><span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(c.status)}">${c.status}</span></td>
                        <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${formatDate(c.dataPrevista)}</td>
                        <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${c.responsavel}</td>
                        <td class="px-6 py-4">
                            <button onclick="editContent('${c.id}')" class="text-indigo-600 hover:text-indigo-800 mr-3"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteContent('${c.id}')" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `).join('');
        }

        function exportAllData() {
            const data = { 
                conteudos: conteudos, 
                marca: marcaData,
                insights: insightsData,
                settings: userSettings, 
                exportDate: new Date().toISOString() 
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `contentflow-complete-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportToCSV() {
            const headers = ['ID', 'Título', 'Mês', 'Data Prevista', 'Canal', 'Tipo', 'Quadro', 'Funil', 'Objetivo', 'Responsável', 'Status', 'Prioridade'];
            const rows = conteudos.map(c => [
                c.id, c.titulo, c.mes, c.dataPrevista, c.canal, c.tipo, c.quadro, c.funil, c.objetivo, c.responsavel, c.status, c.prioridade
            ]);
            
            const csv = [headers.join(','), ...rows.map(r => r.map(v => `"${v}"`).join(','))].join('\n');
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `contentflow-conteudos-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function importAllData(input) {
            const file = input.files[0];
            if (!file) return;
            if (!confirm('Isso substituirá todos os seus dados atuais. Deseja continuar?')) { input.value = ''; return; }
            showLoading(true);
            try {
                const text = await file.text();
                const data = JSON.parse(text);
                if (data.conteudos && Array.isArray(data.conteudos)) {
                    conteudos = data.conteudos;
                    if (data.marca) marcaData = data.marca;
                    if (data.insights) insightsData = data.insights;
                    if (data.settings) userSettings = { ...userSettings, ...data.settings };
                    await saveUserData();
                    alert('Dados importados com sucesso!');
                    navigateTo(currentPage);
                } else { alert('Arquivo inválido!'); }
            } catch (error) { alert('Erro ao importar: ' + error.message); }
            input.value = '';
            showLoading(false);
        }

        function generateStrategicReport() {
            const hoje = new Date();
            const mesAtual = hoje.toISOString().slice(0, 7);
            const conteudosMes = conteudos.filter(c => c.mes === mesAtual);
            const publicados = conteudosMes.filter(c => c.status === 'Publicado');
            
            const porCanal = {};
            const porFunil = { Topo: 0, Meio: 0, Fundo: 0 };
            const porResponsavel = {};
            
            conteudosMes.forEach(c => {
                porCanal[c.canal] = (porCanal[c.canal] || 0) + 1;
                porFunil[c.funil]++;
                porResponsavel[c.responsavel] = (porResponsavel[c.responsavel] || 0) + 1;
            });

            const reportText = `# RELATÓRIO ESTRATÉGICO - CONTENTFLOW\nGerado em: ${hoje.toLocaleDateString('pt-BR')}\n\n## RESUMO DA MARCA\n[Conteúdo do relatório...]`;

            const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `relatorio-estrategico-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function renderContentCard(c) {
            return `<div class="card rounded-xl p-4 shadow-sm border hover:shadow-md transition-shadow cursor-pointer priority-${c.prioridade}" onclick="editContent('${c.id}')">
                <div class="flex justify-between items-start mb-2">
                    <span class="text-xs font-medium px-2 py-1 rounded ${getFunilBadge(c.funil)}">${c.funil}</span>
                    <span class="text-xs text-gray-400 dark:text-gray-500">${c.responsavel}</span>
                </div>
                <h4 class="font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2">${c.titulo}</h4>
                <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-2">
                    <span>${c.canal}</span>
                    <span>${formatDate(c.dataPrevista)}</span>
                </div>
                <div class="text-xs text-indigo-600 dark:text-indigo-400 font-medium truncate mb-2">${c.quadro}</div>
                <div class="flex items-center justify-between">
                    <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(c.status)}">${c.status}</span>
                    ${c.prioridade === 'Alta' ? '<i class="fas fa-flag text-red-500"></i>' : ''}
                </div>
            </div>`;
        }

        function getFunilColor(funil) { return funil === 'Topo' ? 'bg-green-500' : funil === 'Meio' ? 'bg-blue-500' : 'bg-red-500'; }
        function getFunilBadge(funil) { return funil === 'Topo' ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : funil === 'Meio' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300' : 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300'; }
        function getStatusClass(status) { 
            const classes = { 
                'Ideia': 'status-ideia', 
                'Roteiro': 'status-roteiro', 
                'Gravando': 'status-gravando', 
                'Editando': 'status-editando', 
                'Agendado': 'status-agendado', 
                'Publicado': 'status-publicado' 
            }; 
            return classes[status] || 'bg-gray-100 text-gray-600'; 
        }
        function getStatusDot(status) { 
            const colors = { 
                'Ideia': 'bg-gray-400', 
                'Roteiro': 'bg-blue-400', 
                'Gravando': 'bg-yellow-400', 
                'Editando': 'bg-pink-400', 
                'Agendado': 'bg-green-400', 
                'Publicado': 'bg-indigo-400' 
            }; 
            return colors[status] || 'bg-gray-400'; 
        }
        function formatMonth(mesStr) { 
            const [ano, mes] = mesStr.split('-'); 
            return new Date(ano, mes - 1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }); 
        }
        function formatDate(dateStr) { 
            return new Date(dateStr).toLocaleDateString('pt-BR'); 
        }

        // ==================== MODAL & EVENT HANDLERS ====================
        function openModal(id = null) {
            const modal = document.getElementById('content-modal');
            modal.classList.remove('hidden');
            updateSelectOptions();
            if (id) {
                const contentId = String(id);
                const c = conteudos.find(x => String(x.id) === contentId);
                if (c) {
                    document.getElementById('modal-title').textContent = 'Editar Conteúdo';
                    document.getElementById('content-id').value = c.id;
                    document.getElementById('titulo').value = c.titulo;
                    document.getElementById('mes').value = c.mes;
                    document.getElementById('data-prevista').value = c.dataPrevista;
                    document.getElementById('canal').value = c.canal;
                    document.getElementById('tipo').value = c.tipo;
                    document.getElementById('quadro').value = c.quadro || 'Eventual';
                    document.getElementById('funil').value = c.funil;
                    document.getElementById('objetivo').value = c.objetivo;
                    document.getElementById('responsavel').value = c.responsavel;
                    document.getElementById('status').value = c.status;
                    document.getElementById('prioridade').value = c.prioridade;
                    document.getElementById('link-roteiro').value = c.linkRoteiro || '';
                    document.getElementById('link-edicao').value = c.linkEdicao || '';
                    document.getElementById('conteudo-base').value = c.conteudoBase || '';
                    document.getElementById('roteiro').value = c.roteiro || '';
                    document.getElementById('observacoes').value = c.observacoes || '';
                    
                    if (c.datasStatus) {
                        document.getElementById('data-status-ideia').value = c.datasStatus.Ideia || '';
                        document.getElementById('data-status-roteiro').value = c.datasStatus.Roteiro || '';
                        document.getElementById('data-status-gravando').value = c.datasStatus.Gravando || '';
                        document.getElementById('data-status-editando').value = c.datasStatus.Editando || '';
                        document.getElementById('data-status-agendado').value = c.datasStatus.Agendado || '';
                        document.getElementById('data-status-publicado').value = c.datasStatus.Publicado || '';
                    }
                    
                    document.getElementById('save-btn-text').textContent = 'Atualizar';
                } else {
                    alert('Conteúdo não encontrado!');
                    closeModal();
                }
            } else {
                document.getElementById('modal-title').textContent = 'Novo Conteúdo';
                document.getElementById('content-form').reset();
                document.getElementById('content-id').value = '';
                document.getElementById('mes').value = new Date().toISOString().slice(0, 7);
                document.getElementById('data-prevista').value = new Date().toISOString().split('T')[0];
                document.getElementById('quadro').value = 'Eventual';
                document.getElementById('save-btn-text').textContent = 'Salvar';
                
                document.getElementById('data-status-ideia').value = '';
                document.getElementById('data-status-roteiro').value = '';
                document.getElementById('data-status-gravando').value = '';
                document.getElementById('data-status-editando').value = '';
                document.getElementById('data-status-agendado').value = '';
                document.getElementById('data-status-publicado').value = '';
            }
        }

        function updateSelectOptions() {
            const canalSelect = document.getElementById('canal');
            if (canalSelect && userSettings.canais) {
                canalSelect.innerHTML = userSettings.canais.map(c => `<option value="${c}">${c}</option>`).join('');
            }
            const tipoSelect = document.getElementById('tipo');
            if (tipoSelect && userSettings.tipos) {
                tipoSelect.innerHTML = userSettings.tipos.map(t => `<option value="${t}">${t}</option>`).join('');
            }
            const quadroSelect = document.getElementById('quadro');
            if (quadroSelect && userSettings.quadros) {
                quadroSelect.innerHTML = userSettings.quadros.map(q => `<option value="${q}">${q}</option>`).join('');
            }
            const objetivoSelect = document.getElementById('objetivo');
            if (objetivoSelect && userSettings.objetivos) {
                objetivoSelect.innerHTML = userSettings.objetivos.map(o => `<option value="${o}">${o}</option>`).join('');
            }
        }

        function updateStatusDateVisibility() {
            const currentStatus = document.getElementById('status').value;
            document.querySelectorAll('.status-date-field').forEach(field => {
                field.classList.remove('ring-2', 'ring-indigo-500', 'rounded-lg');
            });
            const currentField = document.querySelector(`.status-date-field[data-status="${currentStatus}"]`);
            if (currentField) {
                currentField.classList.add('ring-2', 'ring-indigo-500', 'rounded-lg');
            }
        }

        function closeModal() { 
            document.getElementById('content-modal').classList.add('hidden'); 
        }
        
        function editContent(id) { 
            openModal(id); 
        }
        
        function createNewMonth() {
            const mes = prompt('Digite o mês (YYYY-MM):', new Date().toISOString().slice(0, 7));
            if (mes && /^\d{4}-\d{2}$/.test(mes)) { 
                openModal(); 
                document.getElementById('mes').value = mes; 
            }
        }
        
        function handleSearch(e) {
            if (e.key === 'Enter') {
                const term = e.target.value.toLowerCase();
                const filtered = conteudos.filter(c => c.titulo.toLowerCase().includes(term));
                const container = document.getElementById('content-container');
                container.innerHTML = `<div class="mb-4 flex items-center justify-between"><h3 class="text-lg font-bold text-gray-900 dark:text-white">Resultados: "${e.target.value}"</h3><button onclick="navigateTo('${currentPage}')" class="text-indigo-600">Limpar</button></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">${filtered.map(c => renderContentCard(c)).join('')}</div>`;
            }
        }
        
        function filterBanco() {
            const search = document.getElementById('banco-search').value.toLowerCase();
            const statusFilter = document.getElementById('banco-filter-status').value;
            const canalFilter = document.getElementById('banco-filter-canal').value;
            const filtered = conteudos.filter(c => {
                const matchesSearch = c.titulo.toLowerCase().includes(search);
                const matchesStatus = !statusFilter || c.status === statusFilter;
                const matchesCanal = !canalFilter || c.canal === canalFilter;
                return matchesSearch && matchesStatus && matchesCanal;
            });
            document.getElementById('banco-table-body').innerHTML = filtered.length === 0 ? 
                '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">Nenhum resultado encontrado</td></tr>' : 
                filtered.sort((a, b) => new Date(b.dataPrevista) - new Date(a.dataPrevista)).map(c => 
                    `<tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50">
                        <td class="px-6 py-4 font-medium text-gray-900 dark:text-white">${c.titulo}</td>
                        <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${c.canal}</td>
                        <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${c.tipo}</td>
                        <td class="px-6 py-4"><span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(c.status)}">${c.status}</span></td>
                        <td class="px-6 py-4 text-gray-600 dark:text-gray-400">${formatDate(c.dataPrevista)}</td>
                        <td class="px-6 py-4">
                            <button onclick="editContent('${c.id}')" class="text-indigo-600 hover:text-indigo-800 mr-3"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteContent('${c.id}')" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`
                ).join('');
        }
        
        function toggleSidebar() { 
            document.getElementById('sidebar').classList.toggle('-translate-x-full'); 
        }
        
        function viewMonth(mes) {
            const conteudosMes = conteudos.filter(c => c.mes === mes);
            document.getElementById('month-detail').classList.remove('hidden');
            document.getElementById('month-detail-title').textContent = `Conteúdos de ${formatMonth(mes)}`;
            document.getElementById('month-detail-content').innerHTML = conteudosMes.length === 0 ? 
                '<p class="text-center text-gray-500 dark:text-gray-400 py-8">Nenhum conteúdo neste mês</p>' : 
                `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">${conteudosMes.map(c => renderContentCard(c)).join('')}</div>`;
            document.getElementById('month-detail').scrollIntoView({ behavior: 'smooth' });
        }
        
        function closeMonthDetail() { 
            document.getElementById('month-detail').classList.add('hidden'); 
        }
        
        function changeCalendarMonth(delta) { 
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta); 
            renderCalendario(document.getElementById('content-container')); 
        }
        
        function goToCurrentMonth() { 
            currentCalendarDate = new Date(); 
            renderCalendario(document.getElementById('content-container')); 
        }
        
        function jumpToMonth() {
            const selector = document.getElementById('calendar-month-selector');
            const [ano, mes] = selector.value.split('-');
            currentCalendarDate = new Date(parseInt(ano), parseInt(mes) - 1, 1);
            renderCalendario(document.getElementById('content-container'));
        }

        // ==================== CONFIGURAÇÕES ====================
        function toggleThemeSwitch(element) {
            element.classList.toggle('active');
            const newTheme = toggleTheme();
            saveUserSettings();
        }
        
        async function updateProfile() {
            const newName = document.getElementById('config-name').value;
            if (!newName.trim()) { alert('O nome não pode estar vazio'); return; }
            showLoading(true);
            try {
                await auth.currentUser.updateProfile({ displayName: newName });
                currentUser.name = newName;
                document.getElementById('user-display-name').textContent = newName;
                document.getElementById('sidebar-user-name').textContent = newName;
                document.getElementById('user-avatar').textContent = newName.charAt(0).toUpperCase();
                alert('Perfil atualizado com sucesso!');
            } catch (error) { alert('Erro ao atualizar perfil: ' + error.message); }
            showLoading(false);
        }
        
        async function saveContentOptions() {
            // Já salvo automaticamente em cada alteração, mas mantido para compatibilidade
            await saveUserSettings();
            alert('Configurações salvas com sucesso!');
        }
        
        function exportData() {
            const data = { 
                conteudos: conteudos, 
                settings: userSettings, 
                marca: marcaData,
                insights: insightsData,
                exportDate: new Date().toISOString() 
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `contentflow-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        async function importData(input) {
            const file = input.files[0];
            if (!file) return;
            if (!confirm('Isso substituirá todos os seus dados atuais. Deseja continuar?')) { 
                input.value = ''; 
                return; 
            }
            showLoading(true);
            try {
                const text = await file.text();
                const data = JSON.parse(text);
                if (data.conteudos && Array.isArray(data.conteudos)) {
                    conteudos = data.conteudos;
                    if (data.settings) userSettings = { ...userSettings, ...data.settings };
                    if (data.marca) marcaData = { ...marcaData, ...data.marca };
                    if (data.insights) insightsData = { ...insightsData, ...data.insights };
                    await saveUserData();
                    alert('Dados importados com sucesso!');
                    navigateTo(currentPage);
                } else { 
                    alert('Arquivo inválido!'); 
                }
            } catch (error) { 
                alert('Erro ao importar: ' + error.message); 
            }
            input.value = '';
            showLoading(false);
        }
        
        async function clearAllData() {
            if (!confirm('ATENÇÃO: Isso excluirá PERMANENTEMENTE todos os seus conteúdos. Esta ação não pode ser desfeita. Deseja continuar?')) return;
            if (!confirm('Tem certeza absoluta? Todos os seus dados serão perdidos.')) return;
            showLoading(true);
            conteudos = [];
            marcaData = {
                fundamentos: { proposito: '', missao: '', visao: '', valores: '', posicionamento: '', promessa: '', diferencial: '' },
                publico: { publicoAlvo: '', persona: '', dores: '', desejos: '', linguagem: '', objecoes: '' },
                estrategia: { planejamentoAnual: '', metaCrescimento: '', estrategiaFunil: '', estrategiaMonetizacao: '', frequenciaCanal: '' },
                identidade: { arquetipo: '', tomVoz: '', palavrasPermitidas: '', palavrasProibidas: '', manualVisual: '', cores: '', tipografia: '' },
                cultura: { playlistSpotify: '', referencias: '', manifesto: '' },
                arquivos: []
            };
            insightsData = {
                metaToken: '',
                lastUpdate: null,
                visaoMacro: { alcanceTotal: 0, impressoesTotal: 0, engajamentoMedio: 0, crescimentoSeguidores: 0, melhorConteudo: null, piorConteudo: null },
                conteudos: []
            };
            await saveUserData();
            navigateTo('dashboard');
            showLoading(false);
            alert('Todos os dados foram excluídos.');
        }
    </script>
</body>
</html>
