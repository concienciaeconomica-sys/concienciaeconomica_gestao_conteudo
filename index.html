<!DOCTYPE html>
<html lang="pt-BR" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContentFlow - Gestão de Conteúdo</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { font-family: 'Inter', sans-serif; }
        
        /* ===== VARIÁVEIS CSS PARA CORES PRIMÁRIAS ===== */
        :root {
            --color-primary: 99, 102, 241; /* indigo-600 */
        }
        
        html.dark {
            --color-primary: 129, 140, 248; /* indigo-400 para dark */
        }
        
        .bg-primary { background-color: rgb(var(--color-primary)); }
        .text-primary { color: rgb(var(--color-primary)); }
        .border-primary { border-color: rgb(var(--color-primary)); }
        .ring-primary { ring-color: rgb(var(--color-primary)); }
        
        /* ===== TEMA ESCURO - CLASSES UTILITÁRIAS ===== */
        html.dark {
            color-scheme: dark;
        }
        
        html.dark body {
            background-color: #0f172a; /* slate-950 */
            color: #e2e8f0; /* slate-200 */
        }
        
        html.dark .auth-bg {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
        }
        
        html.dark .auth-card {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        html.dark .auth-card h1,
        html.dark .auth-card label {
            color: #f1f5f9;
        }
        
        html.dark .auth-card input {
            background: #1e293b;
            border-color: rgba(255, 255, 255, 0.1);
            color: #f1f5f9;
        }
        
        html.dark .bg-white {
            background-color: #1e293b !important; /* slate-800 */
        }
        
        html.dark .bg-gray-50 {
            background-color: #0f172a !important; /* slate-950 */
        }
        
        html.dark .bg-gray-100 {
            background-color: #1e293b !important; /* slate-800 */
        }
        
        html.dark .border-gray-100,
        html.dark .border-gray-200 {
            border-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        html.dark .text-gray-900,
        html.dark .text-gray-800 {
            color: #f1f5f9 !important;
        }
        
        html.dark .text-gray-600,
        html.dark .text-gray-700 {
            color: #cbd5e1 !important;
        }
        
        html.dark .text-gray-500 {
            color: #94a3b8 !important;
        }
        
        html.dark .glass {
            background: rgba(30, 41, 59, 0.95);
        }
        
        html.dark .calendar-day {
            background-color: #1e293b;
        }
        
        html.dark .loading-overlay {
            background: rgba(15, 23, 42, 0.9);
        }
        
        html.dark ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        html.dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-in { animation: slideIn 0.3s ease-out; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .sync-pulse { animation: pulse 2s infinite; }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        
        .bg-topo { background-color: #10b981; }
        .bg-meio { background-color: #3b82f6; }
        .bg-fundo { background-color: #ef4444; }
        
        .status-ideia { background-color: #f3f4f6; color: #6b7280; }
        .status-roteiro { background-color: #dbeafe; color: #1e40af; }
        .status-gravando { background-color: #fef3c7; color: #92400e; }
        .status-editando { background-color: #fce7f3; color: #9d174d; }
        .status-agendado { background-color: #d1fae5; color: #065f46; }
        .status-publicado { background-color: #c7d2fe; color: #3730a3; }

        html.dark .status-ideia { background-color: #374151; color: #d1d5db; }
        html.dark .status-roteiro { background-color: #1e3a8a; color: #93c5fd; }
        html.dark .status-gravando { background-color: #78350f; color: #fef3c7; }
        html.dark .status-editando { background-color: #831843; color: #fce7f3; }
        html.dark .status-agendado { background-color: #064e3b; color: #a7f3d0; }
        html.dark .status-publicado { background-color: #312e81; color: #c7d2fe; }

        .priority-Alta { border-left: 4px solid #ef4444; }
        .priority-Média { border-left: 4px solid #f59e0b; }
        .priority-Baixa { border-left: 4px solid #10b981; }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e5e7eb; }
        .calendar-day { background-color: white; min-height: 120px; padding: 0.5rem; }
        
        html.dark .calendar-grid { background-color: #0f172a; }
        
        .kanban-column { min-height: 500px; transition: all 0.3s; }
        
        .dragging { opacity: 0.5; transform: scale(0.95); }
        .drag-over { background-color: #f0f9ff; border: 2px dashed #3b82f6; }
        
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }
        
        .rich-textarea { min-height: 200px; resize: vertical; }

        .auth-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .hidden { display: none !important; }
        
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.9);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ===== RESPONSIVIDADE MOBILE ===== */
        @media (max-width: 1024px) {
            #sidebar {
                transform: translateX(-100%);
            }
            
            #sidebar.open {
                transform: translateX(0);
            }
            
            main {
                margin-left: 0 !important;
            }
            
            .kanban-column {
                min-width: 280px;
            }
            
            #content-modal .pointer-events-auto {
                max-height: 95vh;
                margin: 0.5rem;
            }
        }
        
        @media (max-width: 768px) {
            .calendar-day {
                min-height: 80px;
                font-size: 0.75rem;
            }
        }
        
        /* Sidebar collapsible */
        #sidebar.collapsed {
            width: 80px;
        }
        
        #sidebar.collapsed .sidebar-text {
            display: none;
        }
        
        #sidebar.collapsed .user-info-bottom {
            padding: 1rem 0.5rem;
        }
        
        /* Manter o calendário identificado */
        .calendar-header-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }
        
        html.dark .calendar-header-title {
            color: #f1f5f9;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 h-screen overflow-hidden">

    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay hidden">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-600 dark:text-gray-300 font-medium">Sincronizando...</p>
        </div>
    </div>

    <!-- Sync Status Indicator -->
    <div id="sync-status" class="fixed top-4 right-4 z-50 hidden">
        <div class="flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-medium shadow-lg">
            <i class="fas fa-check-circle"></i>
            <span>Sincronizado</span>
        </div>
    </div>

    <!-- AUTHENTICATION PAGES -->
    <div id="auth-container" class="auth-bg p-4">
        <!-- Login Page -->
        <div id="login-page" class="auth-card w-full max-w-md rounded-2xl shadow-2xl p-8 animate-slide-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-white font-bold text-2xl mx-auto mb-4 shadow-lg">
                    CF
                </div>
                <h1 class="text-2xl font-bold text-gray-900">ContentFlow</h1>
                <p class="text-gray-500 mt-2">Gestão de Conteúdo Digital</p>
                <p class="text-xs text-indigo-600 mt-2 font-medium">☁️ Sincronização em Nuvem</p>
            </div>

            <form onsubmit="handleLogin(event)" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <div class="relative">
                        <i class="fas fa-envelope absolute left-3 top-3 text-gray-400"></i>
                        <input type="email" id="login-email" required 
                               class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                               placeholder="seu@email.com">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                        <input type="password" id="login-password" required 
                               class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                               placeholder="••••••••">
                    </div>
                </div>

                <button type="submit" id="login-btn"
                        class="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg hover:scale-[1.02] transition-all flex items-center justify-center gap-2">
                    <span>Entrar</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </form>

            <div class="mt-6 text-center">
                <p class="text-gray-600">
                    Não tem uma conta? 
                    <button onclick="showRegister()" class="text-indigo-600 hover:text-indigo-800 font-semibold ml-1">Criar conta</button>
                </p>
            </div>
            
            <div class="mt-4 p-4 bg-blue-50 rounded-lg text-xs text-blue-700">
                <i class="fas fa-info-circle mr-1"></i>
                Seus dados são salvos automaticamente na nuvem e sincronizados entre todos os dispositivos.
            </div>
        </div>

        <!-- Register Page -->
        <div id="register-page" class="auth-card w-full max-w-md rounded-2xl shadow-2xl p-8 hidden animate-slide-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-white font-bold text-2xl mx-auto mb-4 shadow-lg">
                    CF
                </div>
                <h1 class="text-2xl font-bold text-gray-900">Criar Conta</h1>
                <p class="text-gray-500 mt-2">Comece a gerenciar seu conteúdo</p>
            </div>

            <form onsubmit="handleRegister(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                    <div class="relative">
                        <i class="fas fa-user absolute left-3 top-3 text-gray-400"></i>
                        <input type="text" id="register-name" required 
                               class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                               placeholder="Seu nome">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <div class="relative">
                        <i class="fas fa-envelope absolute left-3 top-3 text-gray-400"></i>
                        <input type="email" id="register-email" required 
                               class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                               placeholder="seu@email.com">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                        <input type="password" id="register-password" required minlength="6"
                               class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                               placeholder="Mínimo 6 caracteres">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Senha</label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                        <input type="password" id="register-password-confirm" required 
                               class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                               placeholder="Repita a senha">
                    </div>
                </div>

                <button type="submit" id="register-btn"
                        class="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg hover:scale-[1.02] transition-all flex items-center justify-center gap-2">
                    <span>Criar Conta</span>
                    <i class="fas fa-user-plus"></i>
                </button>
            </form>

            <div class="mt-6 text-center">
                <p class="text-gray-600">
                    Já tem uma conta? 
                    <button onclick="showLogin()" class="text-indigo-600 hover:text-indigo-800 font-semibold ml-1">Entrar</button>
                </p>
            </div>
        </div>
    </div>

    <!-- MAIN APPLICATION -->
    <div id="app-container" class="hidden h-screen">
        <!-- Mobile Overlay -->
        <div id="mobile-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden lg:hidden" onclick="toggleSidebar()"></div>
        
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-white dark:bg-slate-900 border-r border-gray-200 dark:border-slate-700 z-40 transition-transform duration-300 flex flex-col">
            <div class="p-6 border-b border-gray-100 dark:border-slate-700 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center text-white font-bold text-xl">
                        CF
                    </div>
                    <div class="sidebar-text">
                        <h1 class="font-bold text-xl text-gray-900 dark:text-slate-100">ContentFlow</h1>
                        <p class="text-xs text-gray-500 dark:text-slate-400" id="user-display-name">Usuário</p>
                    </div>
                </div>
            </div>

            <nav class="p-4 space-y-1 flex-1 overflow-y-auto">
                <button onclick="navigateTo('dashboard')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors" data-page="dashboard">
                    <i class="fas fa-chart-pie w-5"></i>
                    <span class="font-medium sidebar-text">Dashboard</span>
                </button>
                <button onclick="navigateTo('meses')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors" data-page="meses">
                    <i class="fas fa-calendar-alt w-5"></i>
                    <span class="font-medium sidebar-text">Meses</span>
                </button>
                <button onclick="navigateTo('calendario')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors" data-page="calendario">
                    <i class="fas fa-calendar-week w-5"></i>
                    <span class="font-medium sidebar-text">Calendário</span>
                </button>
                <button onclick="navigateTo('pipeline')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors" data-page="pipeline">
                    <i class="fas fa-columns w-5"></i>
                    <span class="font-medium sidebar-text">Pipeline</span>
                </button>
                <button onclick="navigateTo('metricas')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors" data-page="metricas">
                    <i class="fas fa-chart-line w-5"></i>
                    <span class="font-medium sidebar-text">Métricas</span>
                </button>
                <button onclick="navigateTo('banco')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors" data-page="banco">
                    <i class="fas fa-database w-5"></i>
                    <span class="font-medium sidebar-text">Banco de Conteúdos</span>
                </button>
                <button onclick="navigateTo('settings')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors" data-page="settings">
                    <i class="fas fa-cog w-5"></i>
                    <span class="font-medium sidebar-text">Configurações</span>
                </button>
            </nav>

            <div class="border-t border-gray-200 dark:border-slate-700 p-4 space-y-2 flex-shrink-0 user-info-bottom">
                <div class="flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-slate-800 rounded-lg">
                    <div class="w-8 h-8 rounded-full bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center text-indigo-600 dark:text-indigo-300 font-semibold text-sm flex-shrink-0" id="user-avatar">
                        U
                    </div>
                    <div class="flex-1 min-w-0 sidebar-text">
                        <p class="text-sm font-medium text-gray-900 dark:text-slate-100 truncate" id="sidebar-user-name">Usuário</p>
                        <p class="text-xs text-gray-500 dark:text-slate-400 truncate" id="sidebar-user-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="36535b575f5a76534e535b465a591855595b">[email&#160;protected]</a></p>
                    </div>
                </div>
                
                <div id="sidebar-sync-status" class="px-4 py-2 text-xs text-gray-500 dark:text-slate-400 flex items-center gap-2 sidebar-text">
                    <div class="w-2 h-2 rounded-full bg-green-500 sync-pulse"></div>
                    <span>Online - Sincronizado</span>
                </div>
                
                <button onclick="logout()" class="w-full flex items-center justify-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                    <i class="fas fa-sign-out-alt w-5"></i>
                    <span class="font-medium sidebar-text">Sair</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="lg:ml-64 h-full overflow-y-auto bg-gray-50 dark:bg-slate-950">
            <header class="sticky top-0 z-30 glass dark:bg-slate-900/95 border-b border-gray-200 dark:border-slate-700 px-4 lg:px-8 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <button onclick="toggleSidebar()" class="lg:hidden text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-slate-100">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h2 id="page-title" class="text-xl lg:text-2xl font-bold text-gray-900 dark:text-slate-100">Dashboard</h2>
                    </div>
                    
                    <div class="flex items-center gap-2 lg:gap-4">
                        <div class="relative hidden md:block">
                            <input type="text" id="global-search" placeholder="Buscar..." 
                                   class="w-48 lg:w-64 pl-10 pr-4 py-2 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                   onkeyup="handleSearch(event)">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400 dark:text-slate-500"></i>
                        </div>
                        
                        <button onclick="openModal()" class="flex items-center gap-2 px-3 lg:px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-200 dark:shadow-indigo-900/50">
                            <i class="fas fa-plus"></i>
                            <span class="hidden sm:inline">Novo</span>
                        </button>
                    </div>
                </div>
            </header>

            <div id="content-container" class="p-4 lg:p-8"></div>
        </main>
    </div>

    <!-- Content Modal -->
    <div id="content-modal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeModal()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none overflow-y-auto">
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto pointer-events-auto animate-slide-in my-8">
                <div class="sticky top-0 bg-white dark:bg-slate-800 border-b border-gray-100 dark:border-slate-700 px-6 py-4 flex items-center justify-between z-10">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-slate-100" id="modal-title">Novo Conteúdo</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-slate-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-slate-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="content-form" class="p-6 space-y-6" onsubmit="saveContent(event)">
                    <input type="hidden" id="content-id">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Título</label>
                            <input type="text" id="titulo" required class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Mês/Ano</label>
                            <input type="month" id="mes" required class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Data Prevista</label>
                            <input type="date" id="data-prevista" required class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Canal</label>
                            <select id="canal" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="Instagram">Instagram</option>
                                <option value="YouTube">YouTube</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Tipo</label>
                            <select id="tipo" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="Reel">Reel</option>
                                <option value="Shorts">Shorts</option>
                                <option value="Live">Live</option>
                                <option value="Post">Post</option>
                                <option value="Carrossel">Carrossel</option>
                                <option value="Vídeo">Vídeo</option>
                                <option value="Aula">Aula</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Quadro/Tema</label>
                            <select id="quadro" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="Economia na Vida Real">Economia na Vida Real</option>
                                <option value="Decisões Invisíveis">Decisões Invisíveis</option>
                                <option value="30 Formas de Explicar Economia">30 Formas de Explicar Economia</option>
                                <option value="Efeito Borboleta">Efeito Borboleta</option>
                                <option value="O que essa notícia muda na sua vida?">O que essa notícia muda na sua vida?</option>
                                <option value="Política sem Paixão">Política sem Paixão</option>
                                <option value="Respondendo Comentários">Respondendo Comentários</option>
                                <option value="Conversa na Rua">Conversa na Rua</option>
                                <option value="Bastidores">Bastidores</option>
                                <option value="É Novo Aqui?">É Novo Aqui?</option>
                                <option value="O que é Economia?">O que é Economia?</option>
                                <option value="Manifesto">Manifesto</option>
                                <option value="Eventual">Eventual</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Funil</label>
                            <select id="funil" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="Topo">Topo</option>
                                <option value="Meio">Meio</option>
                                <option value="Fundo">Fundo</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Objetivo</label>
                            <select id="objetivo" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="Venda">Venda</option>
                                <option value="Autoridade">Autoridade</option>
                                <option value="Conexão">Conexão</option>
                                <option value="Engajamento">Engajamento</option>
                                <option value="Educação">Educação</option>
                                <option value="Evento">Evento</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Responsável</label>
                            <select id="responsavel" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="Talles">Talles</option>
                                <option value="Andre">Andre</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Status</label>
                            <select id="status" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="Ideia">Ideia</option>
                                <option value="Roteiro">Roteiro</option>
                                <option value="Gravando">Gravando</option>
                                <option value="Editando">Editando</option>
                                <option value="Agendado">Agendado</option>
                                <option value="Publicado">Publicado</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Prioridade</label>
                            <select id="prioridade" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="Baixa">Baixa</option>
                                <option value="Média">Média</option>
                                <option value="Alta">Alta</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Link Roteiro</label>
                            <input type="url" id="link-roteiro" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="https://...">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Link Edição</label>
                            <input type="url" id="link-edicao" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="https://...">
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Conteúdo Base</label>
                            <textarea id="conteudo-base" rows="4" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent rich-textarea" placeholder="Ideias principais, conceitos abordados, links de referência..."></textarea>
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Roteiro</label>
                            <textarea id="roteiro" rows="6" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent rich-textarea" placeholder="Estrutura do roteiro..."></textarea>
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Observações</label>
                            <textarea id="observacoes" rows="3" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                        </div>
                    </div>

                    <div class="flex gap-3 pt-4 border-t border-gray-100 dark:border-slate-700">
                        <button type="button" onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-slate-300 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors">Cancelar</button>
                        <button type="submit" id="save-btn" class="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2">
                            <span>Salvar</span>
                            <i class="fas fa-cloud-upload-alt"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ==================== FIREBASE CONFIG ====================
        
        const firebaseConfig = {
            apiKey: "AIzaSyAV2tQYhyZigwECLfj3xSMS1b7rBPRAnZg",
            authDomain: "gestao-de-conteudo-83103.firebaseapp.com",
            projectId: "gestao-de-conteudo-83103",
            storageBucket: "gestao-de-conteudo-83103.firebasestorage.app",
            messagingSenderId: "874536664374",
            appId: "1:874536664374:web:0051e811d3cfaf99ccc797"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ==================== GLOBAL VARIABLES ====================
        
        let currentUser = null;
        let conteudos = [];
        let currentPage = 'dashboard';
        let draggedItem = null;
        let currentCalendarDate = new Date();
        let unsubscribeSnapshot = null;
        let currentMetricsMonth = new Date().toISOString().slice(0, 7);

        // ==================== INITIALIZATION ====================
        
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadPrimaryColor();
            checkAuth();
        });

        // ==================== THEME MANAGEMENT ====================
        
        function loadTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.className = theme;
        }
        
        function toggleTheme() {
            const html = document.documentElement;
            const newTheme = html.classList.contains('dark') ? 'light' : 'dark';
            html.className = newTheme;
            localStorage.setItem('theme', newTheme);
        }
        
        function loadPrimaryColor() {
            const color = localStorage.getItem('primaryColor');
            if (color) {
                setPrimaryColor(color);
            }
        }
        
        function setPrimaryColor(colorName) {
            const colors = {
                'indigo': '99, 102, 241',
                'blue': '59, 130, 246',
                'green': '34, 197, 94',
                'orange': '249, 115, 22',
                'red': '239, 68, 68',
                'violet': '139, 92, 246',
                'pink': '236, 72, 153',
                'teal': '20, 184, 166'
            };
            
            const colorValue = colors[colorName] || colors['indigo'];
            document.documentElement.style.setProperty('--color-primary', colorValue);
            localStorage.setItem('primaryColor', colorName);
        }

        // ==================== AUTHENTICATION ====================

        function checkAuth() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = {
                        id: user.uid,
                        name: user.displayName || user.email.split('@')[0],
                        email: user.email
                    };
                    loadUserData();
                    showApp();
                } else {
                    showAuth();
                }
            });
        }

        async function handleLogin(e) {
            e.preventDefault();
            showLoading(true);
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                alert('Erro ao entrar: ' + error.message);
                showLoading(false);
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            showLoading(true);
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-password-confirm').value;
            
            if (password !== confirmPassword) {
                alert('As senhas não coincidem!');
                showLoading(false);
                return;
            }
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: name });
                
                await db.collection('users').doc(userCredential.user.uid).set({
                    name: name,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                await db.collection('conteudos').doc(userCredential.user.uid).set({
                    items: generateSampleDataArray()
                });
                
            } catch (error) {
                alert('Erro: ' + error.message);
                showLoading(false);
            }
        }

        async function logout() {
            if (confirm('Deseja sair?')) {
                showLoading(true);
                
                if (unsubscribeSnapshot) {
                    unsubscribeSnapshot();
                    unsubscribeSnapshot = null;
                }
                
                await auth.signOut();
                conteudos = [];
                currentUser = null;
                
                showLoading(false);
                showAuth();
            }
        }

        // ==================== DATA MANAGEMENT ====================

        function loadUserData() {
            if (!currentUser) return;
            
            showLoading(true);
            
            unsubscribeSnapshot = db.collection('conteudos').doc(currentUser.id)
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        conteudos = doc.data().items || [];
                    } else {
                        conteudos = generateSampleDataArray();
                        saveUserData();
                    }
                    if (currentPage) navigateTo(currentPage);
                    showSyncStatus();
                    showLoading(false);
                }, (error) => {
                    console.error("Erro ao sincronizar:", error);
                    alert("Erro ao carregar dados. Verifique sua conexão.");
                    showLoading(false);
                });
        }

        async function saveUserData() {
            if (!currentUser) return;
            
            showSyncStatus('syncing');
            
            try {
                await db.collection('conteudos').doc(currentUser.id).set({
                    items: conteudos,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                showSyncStatus('saved');
            } catch (error) {
                console.error("Erro ao salvar:", error);
                showSyncStatus('error');
            }
        }

        // ==================== UI FUNCTIONS ====================

        function showAuth() {
            document.getElementById('auth-container').classList.remove('hidden');
            document.getElementById('app-container').classList.add('hidden');
            document.getElementById('sync-status').classList.add('hidden');
            showLogin();
        }

        function showApp() {
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            document.getElementById('sync-status').classList.remove('hidden');
            
            document.getElementById('user-display-name').textContent = currentUser.name;
            document.getElementById('sidebar-user-name').textContent = currentUser.name;
            document.getElementById('sidebar-user-email').textContent = currentUser.email;
            document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();
        }

        function showLogin() {
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('register-page').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('register-page').classList.remove('hidden');
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }

        function showSyncStatus(status = 'saved') {
            const indicator = document.getElementById('sync-status');
            const sidebarIndicator = document.getElementById('sidebar-sync-status');
            
            if (status === 'syncing') {
                indicator.innerHTML = '<div class="flex items-center gap-2 px-4 py-2 bg-yellow-100 text-yellow-700 rounded-full text-sm font-medium shadow-lg"><i class="fas fa-sync fa-spin"></i><span>Sincronizando...</span></div>';
                if (sidebarIndicator) sidebarIndicator.innerHTML = '<div class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></div><span>Sincronizando...</span>';
            } else if (status === 'saved') {
                indicator.innerHTML = '<div class="flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-medium shadow-lg"><i class="fas fa-check-circle"></i><span>Sincronizado</span></div>';
                if (sidebarIndicator) sidebarIndicator.innerHTML = '<div class="w-2 h-2 rounded-full bg-green-500"></div><span>Online - Sincronizado</span>';
                setTimeout(() => indicator.classList.add('hidden'), 3000);
            } else if (status === 'error') {
                indicator.innerHTML = '<div class="flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-full text-sm font-medium shadow-lg"><i class="fas fa-exclamation-circle"></i><span>Erro ao sincronizar</span></div>';
                if (sidebarIndicator) sidebarIndicator.innerHTML = '<div class="w-2 h-2 rounded-full bg-red-500"></div><span>Erro de conexão</span>';
            }
            
            indicator.classList.remove('hidden');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            
            if (window.innerWidth < 1024) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('hidden');
            } else {
                sidebar.classList.toggle('collapsed');
            }
        }

        // ==================== CONTENT MANAGEMENT ====================

        async function saveContent(e) {
            e.preventDefault();
            showLoading(true);
            
            const id = document.getElementById('content-id').value;
            const data = {
                titulo: document.getElementById('titulo').value,
                mes: document.getElementById('mes').value,
                dataPrevista: document.getElementById('data-prevista').value,
                canal: document.getElementById('canal').value,
                tipo: document.getElementById('tipo').value,
                quadro: document.getElementById('quadro').value,
                funil: document.getElementById('funil').value,
                objetivo: document.getElementById('objetivo').value,
                responsavel: document.getElementById('responsavel').value,
                status: document.getElementById('status').value,
                prioridade: document.getElementById('prioridade').value,
                linkRoteiro: document.getElementById('link-roteiro').value,
                linkEdicao: document.getElementById('link-edicao').value,
                conteudoBase: document.getElementById('conteudo-base').value,
                roteiro: document.getElementById('roteiro').value,
                observacoes: document.getElementById('observacoes').value,
                atualizadoEm: new Date().toISOString()
            };
            
            if (id) {
                const index = conteudos.findIndex(c => c.id == id);
                conteudos[index] = { ...conteudos[index], ...data };
            } else {
                data.id = Date.now().toString();
                data.criadoEm = new Date().toISOString();
                conteudos.push(data);
            }
            
            await saveUserData();
            closeModal();
            navigateTo(currentPage);
            showLoading(false);
        }

        async function deleteContent(id) {
            if (!confirm('Deseja excluir este conteúdo?')) return;
            
            showLoading(true);
            conteudos = conteudos.filter(c => c.id !== id);
            await saveUserData();
            navigateTo(currentPage);
            showLoading(false);
        }

        async function duplicateLastMonth() {
            const meses = [...new Set(conteudos.map(c => c.mes))].sort();
            if (meses.length === 0) return;
            
            showLoading(true);
            
            const ultimoMes = meses[meses.length - 1];
            const [ano, mes] = ultimoMes.split('-').map(Number);
            let novoAno = ano, novoMes = mes + 1;
            if (novoMes > 12) { novoMes = 1; novoAno++; }
            
            const novoMesStr = `${novoAno}-${String(novoMes).padStart(2, '0')}`;
            
            conteudos.filter(c => c.mes === ultimoMes).forEach(c => {
                const novo = { ...c };
                novo.id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
                novo.mes = novoMesStr;
                novo.status = 'Ideia';
                const data = new Date(c.dataPrevista);
                data.setMonth(data.getMonth() + 1);
                novo.dataPrevista = data.toISOString().split('T')[0];
                novo.criadoEm = new Date().toISOString();
                novo.atualizadoEm = new Date().toISOString();
                conteudos.push(novo);
            });
            
            await saveUserData();
            navigateTo('meses');
            showLoading(false);
        }

        // ==================== DRAG AND DROP ====================

        async function handleDrop(e, newStatus) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            if (draggedItem) {
                const content = conteudos.find(c => c.id === draggedItem);
                if (content) {
                    content.status = newStatus;
                    content.atualizadoEm = new Date().toISOString();
                    await saveUserData();
                    renderPipeline(document.getElementById('content-container'));
                }
            }
        }

        // ==================== RENDER FUNCTIONS ====================

        function navigateTo(page) {
            currentPage = page;
            
            // Fechar sidebar no mobile após navegar
            if (window.innerWidth < 1024) {
                document.getElementById('sidebar').classList.remove('open');
                document.getElementById('mobile-overlay').classList.add('hidden');
            }
            
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.dataset.page === page) {
                    item.classList.add('bg-indigo-50', 'dark:bg-slate-800', 'text-indigo-600', 'dark:text-indigo-400');
                    item.classList.remove('text-gray-600', 'dark:text-slate-300');
                } else {
                    item.classList.remove('bg-indigo-50', 'dark:bg-slate-800', 'text-indigo-600', 'dark:text-indigo-400');
                    item.classList.add('text-gray-600', 'dark:text-slate-300');
                }
            });

            const titles = {
                dashboard: 'Dashboard',
                meses: 'Meses',
                calendario: 'Calendário',
                pipeline: 'Pipeline',
                metricas: 'Métricas',
                banco: 'Banco de Conteúdos',
                settings: 'Configurações'
            };
            document.getElementById('page-title').textContent = titles[page];

            const container = document.getElementById('content-container');
            container.innerHTML = '';
            
            switch(page) {
                case 'dashboard': renderDashboard(container); break;
                case 'meses': renderMeses(container); break;
                case 'calendario': renderCalendario(container); break;
                case 'pipeline': renderPipeline(container); break;
                case 'metricas': renderMetricas(container); break;
                case 'banco': renderBanco(container); break;
                case 'settings': renderSettings(container); break;
            }
        }

        function renderDashboard(container) {
            const hoje = new Date();
            const mesAtual = hoje.toISOString().slice(0, 7);
            const conteudosMes = conteudos.filter(c => c.mes === mesAtual);
            const publicados = conteudosMes.filter(c => c.status === 'Publicado');
            const atrasados = conteudos.filter(c => {
                const dataPrev = new Date(c.dataPrevista);
                return dataPrev < hoje && c.status !== 'Publicado';
            });
            
            const proximaSemana = conteudos.filter(c => {
                const data = new Date(c.dataPrevista);
                const diff = Math.ceil((data - hoje) / (1000 * 60 * 60 * 24));
                return diff >= 0 && diff <= 7 && c.status !== 'Publicado';
            }).sort((a, b) => new Date(a.dataPrevista) - new Date(b.dataPrevista));

            const execucao = conteudosMes.length > 0 ? Math.round((publicados.length / conteudosMes.length) * 100) : 0;

            const funilData = {
                Topo: conteudosMes.filter(c => c.funil === 'Topo').length,
                Meio: conteudosMes.filter(c => c.funil === 'Meio').length,
                Fundo: conteudosMes.filter(c => c.funil === 'Fundo').length
            };

            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-8">
                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center text-blue-600 dark:text-blue-400">
                                <i class="fas fa-calendar-check text-xl"></i>
                            </div>
                            <span class="text-sm text-gray-500 dark:text-slate-400">Mês Atual</span>
                        </div>
                        <p class="text-3xl font-bold text-gray-900 dark:text-slate-100">${conteudosMes.length}</p>
                        <p class="text-sm text-gray-500 dark:text-slate-400 mt-1">Total Planejado</p>
                    </div>

                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center text-green-600 dark:text-green-400">
                                <i class="fas fa-check-circle text-xl"></i>
                            </div>
                            <span class="text-sm text-gray-500 dark:text-slate-400">Publicados</span>
                        </div>
                        <p class="text-3xl font-bold text-gray-900 dark:text-slate-100">${publicados.length}</p>
                        <p class="text-sm text-gray-500 dark:text-slate-400 mt-1">Conteúdos no ar</p>
                    </div>

                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center text-purple-600 dark:text-purple-400">
                                <i class="fas fa-percentage text-xl"></i>
                            </div>
                            <span class="text-sm text-gray-500 dark:text-slate-400">Execução</span>
                        </div>
                        <p class="text-3xl font-bold text-gray-900 dark:text-slate-100">${execucao}%</p>
                        <div class="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2 mt-2">
                            <div class="bg-purple-600 h-2 rounded-full transition-all" style="width: ${execucao}%"></div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700 ${atrasados.length > 0 ? 'ring-2 ring-red-100 dark:ring-red-900/50' : ''}">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 ${atrasados.length > 0 ? 'bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400' : 'bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-400'} rounded-xl flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-xl"></i>
                            </div>
                            <span class="text-sm ${atrasados.length > 0 ? 'text-red-600 dark:text-red-400 font-semibold' : 'text-gray-500 dark:text-slate-400'}">Atrasados</span>
                        </div>
                        <p class="text-3xl font-bold ${atrasados.length > 0 ? 'text-red-600 dark:text-red-400' : 'text-gray-900 dark:text-slate-100'}">${atrasados.length}</p>
                        <p class="text-sm ${atrasados.length > 0 ? 'text-red-500 dark:text-red-400' : 'text-gray-500 dark:text-slate-400'} mt-1">Precisam atenção</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">
                    <div class="lg:col-span-2 bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-6">Próximos 7 Dias</h3>
                        <div class="space-y-3">
                            ${proximaSemana.length === 0 ? '<p class="text-gray-500 dark:text-slate-400 text-center py-8">Nenhum conteúdo agendado para esta semana</p>' : ''}
                            ${proximaSemana.map(c => `
                                <div class="flex items-center gap-4 p-4 bg-gray-50 dark:bg-slate-700/50 rounded-xl hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors cursor-pointer" onclick="editContent(${c.id})">
                                    <div class="w-12 h-12 rounded-lg ${getFunilColor(c.funil)} flex items-center justify-center text-white font-bold flex-shrink-0">
                                        ${new Date(c.dataPrevista).getDate()}
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-semibold text-gray-900 dark:text-slate-100 truncate">${c.titulo}</h4>
                                        <p class="text-sm text-gray-500 dark:text-slate-400 truncate">${c.canal} • ${c.tipo} • ${c.responsavel}</p>
                                    </div>
                                    <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusClass(c.status)} flex-shrink-0">${c.status}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-6">Distribuição por Funil</h3>
                        <canvas id="funilChart"></canvas>
                        <div class="mt-6 space-y-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                                    <span class="text-sm text-gray-600 dark:text-slate-300">Topo</span>
                                </div>
                                <span class="font-semibold text-gray-900 dark:text-slate-100">${funilData.Topo}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                                    <span class="text-sm text-gray-600 dark:text-slate-300">Meio</span>
                                </div>
                                <span class="font-semibold text-gray-900 dark:text-slate-100">${funilData.Meio}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                                    <span class="text-sm text-gray-600 dark:text-slate-300">Fundo</span>
                                </div>
                                <span class="font-semibold text-gray-900 dark:text-slate-100">${funilData.Fundo}</span>
                            </div>
                        </div>
                    </div>
                </div>

                ${atrasados.length > 0 ? `
                <div class="mt-8 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-red-800 dark:text-red-400 mb-4 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        Conteúdos Atrasados
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${atrasados.map(c => renderContentCard(c)).join('')}
                    </div>
                </div>
                ` : ''}
            `;

            setTimeout(() => {
                const ctx = document.getElementById('funilChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Topo', 'Meio', 'Fundo'],
                            datasets: [{
                                data: [funilData.Topo, funilData.Meio, funilData.Fundo],
                                backgroundColor: ['#10b981', '#3b82f6', '#ef4444'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: { legend: { display: false } }
                        }
                    });
                }
            }, 100);
        }

        function renderMeses(container) {
            const meses = [...new Set(conteudos.map(c => c.mes))].sort().reverse();
            const mesAtual = new Date().toISOString().slice(0, 7);

            container.innerHTML = `
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                    <div class="flex gap-2">
                        <button onclick="createNewMonth()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm lg:text-base">
                            <i class="fas fa-plus mr-2"></i>Novo Mês
                        </button>
                        ${meses.length > 0 ? `
                        <button onclick="duplicateLastMonth()" class="px-4 py-2 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-slate-300 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors text-sm lg:text-base">
                            <i class="fas fa-copy mr-2"></i><span class="hidden sm:inline">Duplicar</span>
                        </button>
                        ` : ''}
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6">
                    ${meses.map(mes => {
                        const conteudosMes = conteudos.filter(c => c.mes === mes);
                        const publicados = conteudosMes.filter(c => c.status === 'Publicado');
                        const progresso = conteudosMes.length > 0 ? Math.round((publicados.length / conteudosMes.length) * 100) : 0;
                        const isCurrent = mes === mesAtual;
                        
                        return `
                        <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border ${isCurrent ? 'border-indigo-500 ring-2 ring-indigo-100 dark:ring-indigo-900/50' : 'border-gray-100 dark:border-slate-700'} hover:shadow-md transition-shadow cursor-pointer" onclick="viewMonth('${mes}')">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-slate-100">${formatMonth(mes)}</h3>
                                ${isCurrent ? '<span class="px-2 py-1 bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 text-xs font-semibold rounded-full">Atual</span>' : ''}
                            </div>
                            
                            <div class="space-y-4">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-slate-400">Total de Conteúdos</span>
                                    <span class="font-semibold text-gray-900 dark:text-slate-100">${conteudosMes.length}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-slate-400">Publicados</span>
                                    <span class="font-semibold text-green-600 dark:text-green-400">${publicados.length}</span>
                                </div>
                                
                                <div class="pt-2">
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="text-gray-500 dark:text-slate-400">Progresso</span>
                                        <span class="font-semibold text-gray-900 dark:text-slate-100">${progresso}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2">
                                        <div class="bg-indigo-600 h-2 rounded-full transition-all" style="width: ${progresso}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>

                <div id="month-detail" class="mt-8 hidden">
                    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-gray-100 dark:border-slate-700 overflow-hidden">
                        <div class="p-6 border-b border-gray-100 dark:border-slate-700 flex justify-between items-center">
                            <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100" id="month-detail-title">Detalhes do Mês</h3>
                            <button onclick="closeMonthDetail()" class="text-gray-400 hover:text-gray-600 dark:hover:text-slate-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="p-6" id="month-detail-content"></div>
                    </div>
                </div>
            `;
        }

        function renderCalendario(container) {
            const ano = currentCalendarDate.getFullYear();
            const mes = currentCalendarDate.getMonth();
            
            const primeiroDia = new Date(ano, mes, 1);
            const ultimoDia = new Date(ano, mes + 1, 0);
            const diasNoMes = ultimoDia.getDate();
            const diaSemanaInicio = primeiroDia.getDay();
            
            const mesStr = `${ano}-${String(mes + 1).padStart(2, '0')}`;
            const conteudosMes = conteudos.filter(c => c.mes === mesStr);
            const todosMeses = [...new Set(conteudos.map(c => c.mes))].sort();
            
            // Formatação do título do mês atual
            const mesNome = currentCalendarDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            const mesCapitalizado = mesNome.charAt(0).toUpperCase() + mesNome.slice(1);
            
            let diasHTML = '';
            const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            
            diasHTML += diasSemana.map(d => `
                <div class="bg-gray-50 dark:bg-slate-800 p-3 text-center text-sm font-semibold text-gray-600 dark:text-slate-300 border-b border-gray-200 dark:border-slate-700">${d}</div>
            `).join('');

            for (let i = 0; i < diaSemanaInicio; i++) {
                diasHTML += '<div class="calendar-day bg-gray-50 dark:bg-slate-900"></div>';
            }

            const hoje = new Date();
            for (let dia = 1; dia <= diasNoMes; dia++) {
                const dataStr = `${ano}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
                const conteudosDia = conteudosMes.filter(c => c.dataPrevista === dataStr);
                const isHoje = dia === hoje.getDate() && mes === hoje.getMonth() && ano === hoje.getFullYear();
                
                diasHTML += `
                    <div class="calendar-day p-2 ${isHoje ? 'bg-indigo-50 dark:bg-indigo-900/20 ring-2 ring-indigo-200 dark:ring-indigo-800' : ''}">
                        <div class="font-semibold text-sm mb-2 ${isHoje ? 'text-indigo-600 dark:text-indigo-400' : 'text-gray-700 dark:text-slate-300'}">${dia}</div>
                        <div class="space-y-1">
                            ${conteudosDia.map(c => `
                                <div onclick="editContent(${c.id})" class="text-xs p-2 rounded cursor-pointer hover:opacity-80 transition-opacity ${getFunilColor(c.funil)} text-white truncate" title="${c.titulo}">
                                    <div class="font-medium truncate">${c.titulo}</div>
                                    <div class="text-xs opacity-90">${c.canal}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-gray-100 dark:border-slate-700 overflow-hidden">
                    <div class="p-4 lg:p-6 border-b border-gray-100 dark:border-slate-700">
                        <!-- Título do Mês Atual -->
                        <h3 class="calendar-header-title text-center mb-4">${mesCapitalizado}</h3>
                        
                        <div class="flex flex-col sm:flex-row flex-wrap items-center justify-between gap-4">
                            <select id="calendar-month-selector" onchange="jumpToMonth()" class="w-full sm:w-auto px-4 py-2 border border-gray-200 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 font-semibold text-gray-900">
                                ${todosMeses.map(m => `<option value="${m}" ${m === mesStr ? 'selected' : ''}>${formatMonth(m)}</option>`).join('')}
                            </select>
                            <div class="flex gap-2 w-full sm:w-auto">
                                <button onclick="changeCalendarMonth(-1)" class="flex-1 sm:flex-none w-10 h-10 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 flex items-center justify-center border border-gray-200 dark:border-slate-600">
                                    <i class="fas fa-chevron-left text-gray-600 dark:text-slate-300"></i>
                                </button>
                                <button onclick="changeCalendarMonth(1)" class="flex-1 sm:flex-none w-10 h-10 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 flex items-center justify-center border border-gray-200 dark:border-slate-600">
                                    <i class="fas fa-chevron-right text-gray-600 dark:text-slate-300"></i>
                                </button>
                                <button onclick="goToCurrentMonth()" class="flex-1 sm:flex-none px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 border border-gray-200 dark:border-slate-600 text-sm font-medium text-gray-700 dark:text-slate-300">Hoje</button>
                            </div>
                        </div>
                    </div>
                    <div class="calendar-grid overflow-x-auto">${diasHTML}</div>
                </div>
            `;
        }

        function renderPipeline(container) {
            const statusList = ['Ideia', 'Roteiro', 'Gravando', 'Editando', 'Agendado', 'Publicado'];
            
            container.innerHTML = `
                <div class="flex gap-4 overflow-x-auto pb-4" style="min-height: 600px;">
                    ${statusList.map(status => {
                        const items = conteudos.filter(c => c.status === status);
                        return `
                        <div class="flex-shrink-0 w-full sm:w-80">
                            <div class="bg-gray-100 dark:bg-slate-800 rounded-2xl p-4 h-full">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="font-bold text-gray-700 dark:text-slate-200 flex items-center gap-2">
                                        <span class="w-2 h-2 rounded-full ${getStatusDot(status)}"></span>
                                        ${status}
                                    </h3>
                                    <span class="bg-gray-200 dark:bg-slate-700 text-gray-600 dark:text-slate-300 text-xs font-bold px-2 py-1 rounded-full">${items.length}</span>
                                </div>
                                <div class="kanban-column space-y-3" ondragover="handleDragOver(event)" ondrop="handleDrop(event, '${status}')" ondragleave="handleDragLeave(event)">
                                    ${items.map(c => `
                                        <div draggable="true" ondragstart="handleDragStart(event, ${c.id})" ondragend="handleDragEnd(event)"
                                             class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-slate-600 cursor-move hover:shadow-md transition-shadow priority-${c.prioridade}"
                                             onclick="editContent(${c.id})">
                                            <div class="flex justify-between items-start mb-2">
                                                <span class="text-xs font-medium px-2 py-1 rounded ${getFunilBadge(c.funil)}">${c.funil}</span>
                                                <span class="text-xs text-gray-400 dark:text-slate-500">${c.responsavel}</span>
                                            </div>
                                            <h4 class="font-semibold text-gray-900 dark:text-slate-100 mb-2 line-clamp-2">${c.titulo}</h4>
                                            <div class="text-xs text-gray-500 dark:text-slate-400">${c.canal} • ${formatDate(c.dataPrevista)}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderMetricas(container) {
            const todosMeses = [...new Set(conteudos.map(c => c.mes))].sort().reverse();
            const conteudosMes = conteudos.filter(c => c.mes === currentMetricsMonth);
            
            const porCanal = {};
            const porFunil = { Topo: 0, Meio: 0, Fundo: 0 };
            const porResponsavel = {};
            const porStatus = {};
            
            conteudosMes.forEach(c => {
                porCanal[c.canal] = (porCanal[c.canal] || 0) + 1;
                porFunil[c.funil]++;
                porResponsavel[c.responsavel] = (porResponsavel[c.responsavel] || 0) + 1;
                porStatus[c.status] = (porStatus[c.status] || 0) + 1;
            });

            container.innerHTML = `
                <!-- Seletor de Mês para Métricas -->
                <div class="mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100">Métricas - ${formatMonth(currentMetricsMonth)}</h3>
                    <select id="metrics-month-selector" onchange="changeMetricsMonth()" class="w-full sm:w-auto px-4 py-2 border border-gray-200 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 font-semibold">
                        ${todosMeses.map(m => `<option value="${m}" ${m === currentMetricsMonth ? 'selected' : ''}>${formatMonth(m)}</option>`).join('')}
                    </select>
                </div>
            
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6 mb-8">
                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-4">Conteúdos por Canal</h3>
                        <canvas id="chartCanal"></canvas>
                    </div>
                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-4">Distribuição por Funil</h3>
                        <canvas id="chartFunil"></canvas>
                    </div>
                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-4">Por Responsável</h3>
                        <canvas id="chartResponsavel"></canvas>
                    </div>
                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-4">Por Status</h3>
                        <canvas id="chartStatus"></canvas>
                    </div>
                </div>
            `;

            setTimeout(() => {
                new Chart(document.getElementById('chartCanal'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(porCanal),
                        datasets: [{ label: 'Conteúdos', data: Object.values(porCanal), backgroundColor: '#6366f1', borderRadius: 6 }]
                    },
                    options: { responsive: true, plugins: { legend: { display: false } } }
                });

                new Chart(document.getElementById('chartFunil'), {
                    type: 'pie',
                    data: {
                        labels: ['Topo', 'Meio', 'Fundo'],
                        datasets: [{ data: [porFunil.Topo, porFunil.Meio, porFunil.Fundo], backgroundColor: ['#10b981', '#3b82f6', '#ef4444'] }]
                    },
                    options: { responsive: true }
                });
                
                new Chart(document.getElementById('chartResponsavel'), {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(porResponsavel),
                        datasets: [{ data: Object.values(porResponsavel), backgroundColor: ['#8b5cf6', '#ec4899'] }]
                    },
                    options: { responsive: true }
                });
                
                new Chart(document.getElementById('chartStatus'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(porStatus),
                        datasets: [{ label: 'Conteúdos', data: Object.values(porStatus), backgroundColor: '#3b82f6', borderRadius: 6 }]
                    },
                    options: { responsive: true, plugins: { legend: { display: false } }, indexAxis: 'y' }
                });
            }, 100);
        }
        
        function changeMetricsMonth() {
            currentMetricsMonth = document.getElementById('metrics-month-selector').value;
            renderMetricas(document.getElementById('content-container'));
        }

        function renderBanco(container) {
            container.innerHTML = `
                <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-gray-100 dark:border-slate-700 overflow-hidden">
                    <div class="p-4 border-b border-gray-100 dark:border-slate-700">
                        <input type="text" id="banco-search" placeholder="Buscar..." class="w-full px-4 py-2 border border-gray-200 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" onkeyup="filterBanco()">
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 dark:bg-slate-700 text-gray-600 dark:text-slate-300 text-sm uppercase">
                                <tr>
                                    <th class="px-6 py-3">Título</th>
                                    <th class="px-6 py-3">Canal</th>
                                    <th class="px-6 py-3">Tipo</th>
                                    <th class="px-6 py-3">Status</th>
                                    <th class="px-6 py-3">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="banco-table-body" class="divide-y divide-gray-100 dark:divide-slate-700">
                                ${conteudos.map(c => `
                                    <tr class="hover:bg-gray-50 dark:hover:bg-slate-700/50">
                                        <td class="px-6 py-4 font-medium text-gray-900 dark:text-slate-100">${c.titulo}</td>
                                        <td class="px-6 py-4 text-gray-600 dark:text-slate-300">${c.canal}</td>
                                        <td class="px-6 py-4 text-gray-600 dark:text-slate-300">${c.tipo}</td>
                                        <td class="px-6 py-4"><span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(c.status)}">${c.status}</span></td>
                                        <td class="px-6 py-4">
                                            <button onclick="editContent(${c.id})" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 mr-2"><i class="fas fa-edit"></i></button>
                                            <button onclick="deleteContent(${c.id})" class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300"><i class="fas fa-trash"></i></button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function renderSettings(container) {
            const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            const currentColor = localStorage.getItem('primaryColor') || 'indigo';
            
            container.innerHTML = `
                <div class="max-w-4xl space-y-6">
                    <!-- Aparência -->
                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-4">Aparência</h3>
                        
                        <div class="space-y-4">
                            <!-- Tema -->
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-900 dark:text-slate-100">Tema Escuro</p>
                                    <p class="text-sm text-gray-500 dark:text-slate-400">Ativar modo escuro</p>
                                </div>
                                <button onclick="toggleTheme()" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${currentTheme === 'dark' ? 'bg-indigo-600' : 'bg-gray-200'}">
                                    <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${currentTheme === 'dark' ? 'translate-x-6' : 'translate-x-1'}"></span>
                                </button>
                            </div>
                            
                            <!-- Cor Primária -->
                            <div>
                                <p class="font-medium text-gray-900 dark:text-slate-100 mb-3">Cor Primária</p>
                                <div class="grid grid-cols-4 gap-3">
                                    ${['indigo', 'blue', 'green', 'orange', 'red', 'violet', 'pink', 'teal'].map(color => `
                                        <button onclick="setPrimaryColor('${color}')" 
                                                class="w-full h-12 rounded-lg transition-all ${currentColor === color ? 'ring-2 ring-offset-2 ring-gray-900 dark:ring-slate-100' : ''}"
                                                style="background-color: ${getColorValue(color)}">
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Perfil -->
                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-4">Perfil</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Nome</label>
                                <input type="text" value="${currentUser.name}" readonly class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg" disabled>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Email</label>
                                <input type="email" value="${currentUser.email}" readonly class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 rounded-lg" disabled>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dados -->
                    <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-slate-700">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-4">Gerenciamento de Dados</h3>
                        <div class="space-y-3">
                            <button onclick="exportData()" class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                                <i class="fas fa-download mr-2"></i>Exportar Dados (JSON)
                            </button>
                            <button onclick="importData()" class="w-full px-4 py-2 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-slate-300 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors">
                                <i class="fas fa-upload mr-2"></i>Importar Dados
                            </button>
                            <button onclick="clearAllData()" class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                <i class="fas fa-trash mr-2"></i>Limpar Todos os Dados
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getColorValue(colorName) {
            const colors = {
                'indigo': '#6366f1',
                'blue': '#3b82f6',
                'green': '#22c55e',
                'orange': '#f97316',
                'red': '#ef4444',
                'violet': '#8b5cf6',
                'pink': '#ec4899',
                'teal': '#14b8a6'
            };
            return colors[colorName] || colors['indigo'];
        }
        
        function exportData() {
            const dataStr = JSON.stringify({ conteudos: conteudos }, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `contentflow-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = async (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (data.conteudos && Array.isArray(data.conteudos)) {
                                conteudos = data.conteudos;
                                await saveUserData();
                                alert('Dados importados com sucesso!');
                                navigateTo(currentPage);
                            } else {
                                alert('Formato de arquivo inválido!');
                            }
                        } catch (error) {
                            alert('Erro ao importar dados: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function clearAllData() {
            if (confirm('ATENÇÃO: Isso irá excluir TODOS os seus conteúdos permanentemente. Esta ação não pode ser desfeita. Deseja continuar?')) {
                if (confirm('Tem certeza ABSOLUTA? Todos os dados serão perdidos!')) {
                    showLoading(true);
                    conteudos = [];
                    saveUserData().then(() => {
                        showLoading(false);
                        alert('Todos os dados foram excluídos.');
                        navigateTo('dashboard');
                    });
                }
            }
        }

        function renderContentCard(c) {
            return `
                <div class="bg-white dark:bg-slate-700 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-slate-600 hover:shadow-md transition-shadow cursor-pointer priority-${c.prioridade}" onclick="editContent(${c.id})">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-medium px-2 py-1 rounded ${getFunilBadge(c.funil)}">${c.funil}</span>
                        <span class="text-xs text-gray-400 dark:text-slate-500">${c.responsavel}</span>
                    </div>
                    <h4 class="font-semibold text-gray-900 dark:text-slate-100 mb-2 line-clamp-2">${c.titulo}</h4>
                    <div class="flex items-center justify-between text-xs text-gray-500 dark:text-slate-400 mb-2">
                        <span>${c.canal}</span>
                        <span>${formatDate(c.dataPrevista)}</span>
                    </div>
                    <div class="text-xs text-indigo-600 dark:text-indigo-400 font-medium truncate mb-2">${c.quadro}</div>
                    <div class="flex items-center justify-between">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(c.status)}">${c.status}</span>
                        ${c.prioridade === 'Alta' ? '<i class="fas fa-flag text-red-500 dark:text-red-400"></i>' : ''}
                    </div>
                </div>
            `;
        }

        function getFunilColor(funil) {
            return funil === 'Topo' ? 'bg-green-500' : funil === 'Meio' ? 'bg-blue-500' : 'bg-red-500';
        }

        function getFunilBadge(funil) {
            return funil === 'Topo' ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400' : funil === 'Meio' ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400' : 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400';
        }

        function getStatusClass(status) {
            const classes = { 
                'Ideia': 'status-ideia', 
                'Roteiro': 'status-roteiro', 
                'Gravando': 'status-gravando', 
                'Editando': 'status-editando', 
                'Agendado': 'status-agendado', 
                'Publicado': 'status-publicado' 
            };
            return classes[status] || 'bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-300';
        }

        function getStatusDot(status) {
            const colors = { 
                'Ideia': 'bg-gray-400', 
                'Roteiro': 'bg-blue-400', 
                'Gravando': 'bg-yellow-400', 
                'Editando': 'bg-pink-400', 
                'Agendado': 'bg-green-400', 
                'Publicado': 'bg-indigo-400' 
            };
            return colors[status] || 'bg-gray-400';
        }

        function formatMonth(mesStr) {
            const [ano, mes] = mesStr.split('-');
            return new Date(ano, mes - 1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }).replace(/^\w/, c => c.toUpperCase());
        }

        function formatDate(dateStr) {
            return new Date(dateStr + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function generateSampleDataArray() {
            return []; // Iniciar vazio para novos usuários
        }

        // ==================== MODAL & EVENT HANDLERS ====================

        function openModal(id = null) {
            const modal = document.getElementById('content-modal');
            modal.classList.remove('hidden');
            
            if (id) {
                const c = conteudos.find(x => x.id === id);
                document.getElementById('modal-title').textContent = 'Editar Conteúdo';
                document.getElementById('content-id').value = c.id;
                document.getElementById('titulo').value = c.titulo;
                document.getElementById('mes').value = c.mes;
                document.getElementById('data-prevista').value = c.dataPrevista;
                document.getElementById('canal').value = c.canal;
                document.getElementById('tipo').value = c.tipo;
                document.getElementById('quadro').value = c.quadro || 'Eventual';
                document.getElementById('funil').value = c.funil;
                document.getElementById('objetivo').value = c.objetivo;
                document.getElementById('responsavel').value = c.responsavel;
                document.getElementById('status').value = c.status;
                document.getElementById('prioridade').value = c.prioridade;
                document.getElementById('link-roteiro').value = c.linkRoteiro || '';
                document.getElementById('link-edicao').value = c.linkEdicao || '';
                document.getElementById('conteudo-base').value = c.conteudoBase || '';
                document.getElementById('roteiro').value = c.roteiro || '';
                document.getElementById('observacoes').value = c.observacoes || '';
            } else {
                document.getElementById('modal-title').textContent = 'Novo Conteúdo';
                document.getElementById('content-form').reset();
                document.getElementById('content-id').value = '';
                document.getElementById('mes').value = new Date().toISOString().slice(0, 7);
                document.getElementById('data-prevista').value = new Date().toISOString().split('T')[0];
                document.getElementById('quadro').value = 'Eventual';
            }
        }

        function closeModal() {
            document.getElementById('content-modal').classList.add('hidden');
        }

        function editContent(id) {
            openModal(id);
        }

        function createNewMonth() {
            const mes = prompt('Digite o mês (YYYY-MM):', new Date().toISOString().slice(0, 7));
            if (mes && /^\d{4}-\d{2}$/.test(mes)) {
                openModal();
                document.getElementById('mes').value = mes;
            }
        }

        function handleSearch(e) {
            if (e.key === 'Enter') {
                const term = e.target.value.toLowerCase();
                const filtered = conteudos.filter(c => c.titulo.toLowerCase().includes(term));
                
                const container = document.getElementById('content-container');
                container.innerHTML = `
                    <div class="mb-4 flex items-center justify-between">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100">Resultados: "${e.target.value}"</h3>
                        <button onclick="navigateTo('${currentPage}')" class="text-indigo-600 dark:text-indigo-400">Limpar</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${filtered.map(c => renderContentCard(c)).join('')}
                    </div>
                `;
            }
        }

        function filterBanco() {
            const search = document.getElementById('banco-search').value.toLowerCase();
            const filtered = conteudos.filter(c => c.titulo.toLowerCase().includes(search));
            document.getElementById('banco-table-body').innerHTML = filtered.map(c => `
                <tr class="hover:bg-gray-50 dark:hover:bg-slate-700/50">
                    <td class="px-6 py-4 font-medium text-gray-900 dark:text-slate-100">${c.titulo}</td>
                    <td class="px-6 py-4 text-gray-600 dark:text-slate-300">${c.canal}</td>
                    <td class="px-6 py-4 text-gray-600 dark:text-slate-300">${c.tipo}</td>
                    <td class="px-6 py-4"><span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(c.status)}">${c.status}</span></td>
                    <td class="px-6 py-4">
                        <button onclick="editContent(${c.id})" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 mr-2"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteContent(${c.id})" class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function viewMonth(mes) {
            const conteudosMes = conteudos.filter(c => c.mes === mes);
            document.getElementById('month-detail').classList.remove('hidden');
            document.getElementById('month-detail-title').textContent = `Conteúdos de ${formatMonth(mes)}`;
            document.getElementById('month-detail-content').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                    ${conteudosMes.map(c => renderContentCard(c)).join('')}
                </div>
            `;
            document.getElementById('month-detail').scrollIntoView({ behavior: 'smooth' });
        }

        function closeMonthDetail() {
            document.getElementById('month-detail').classList.add('hidden');
        }

        function changeCalendarMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            renderCalendario(document.getElementById('content-container'));
        }

        function goToCurrentMonth() {
            currentCalendarDate = new Date();
            renderCalendario(document.getElementById('content-container'));
        }

        function jumpToMonth() {
            const selector = document.getElementById('calendar-month-selector');
            const [ano, mes] = selector.value.split('-');
            currentCalendarDate = new Date(parseInt(ano), parseInt(mes) - 1, 1);
            renderCalendario(document.getElementById('content-container'));
        }

        function handleDragStart(e, id) { draggedItem = id; e.target.classList.add('dragging'); }
        function handleDragEnd(e) { e.target.classList.remove('dragging'); }
        function handleDragOver(e) { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
        function handleDragLeave(e) { e.currentTarget.classList.remove('drag-over'); }
    </script>
</body>
</html>
